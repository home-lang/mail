# TODO List for SMTP Server

## Recent Updates ðŸ“

### v0.35.0 (2025-12-02) - Inline Image Support ðŸ–¼ï¸
- âœ… **Inline Image System**: Complete CID-based inline image handling (`src/features/inline_images.zig`)
  - **Content-ID Parsing**:
    - `parseContentId()` - Strip angle brackets and whitespace
    - `generateContentId()` - Create unique CIDs for new images
    - MIME multipart parsing for inline attachments
  - **InlineImageStore**:
    - Store attachments by Content-ID
    - Track images by message ID
    - Base64 encoding with pre-encode option
    - SHA-256 content hashing
    - Configurable max size (default 10MB)
    - Allowed MIME type validation
  - **CID URL Resolution**:
    - `resolveHtml()` - Replace cid: URLs with data URIs
    - Automatic detection and replacement in HTML bodies
    - Support for quoted and unquoted CID references
  - **Data URI Generation**:
    - `toDataUri()` - Convert image to data:mime;base64 format
    - `createInlineImgTag()` - Generate complete img tags
  - **Webmail Integration** (`src/api/webmail.zig`):
    - `GET /webmail/api/inline/:cid` - Get image by Content-ID
    - `GET /webmail/api/inline-stats` - Storage statistics
    - `POST /webmail/api/inline` - Upload inline image
    - `resolveInlineImages()` - Process email HTML
    - `storeInlineImage()` - Store from MIME part
  - **Compose UI Features**:
    - "Image" button in compose toolbar with icon
    - Insert Image modal with drag-and-drop zone
    - File picker for local images
    - URL input for external images
    - Image preview thumbnails with remove button
    - Clipboard paste support for images
    - Automatic insertion at cursor position
  - **CSS Styling**:
    - `.inline-image-container` - Thumbnail with remove button
    - `.insert-image-modal` - Upload dialog
    - `.image-upload-zone` - Drag-and-drop area with hover state
    - Responsive image display in email body
  - **JavaScript Functions**:
    - `openInsertImage()` / `closeInsertImage()` - Modal control
    - `processImageFile()` - FileReader with validation
    - `insertImageAtCursor()` - Cursor-aware insertion
    - `handleImageDrop()` - Drag-and-drop handler
    - Paste event listener for clipboard images
  - **Tests**: 5 unit tests for CID parsing and storage

### v0.34.0 (2025-12-02) - Email Thread/Conversation View ðŸ’¬
- âœ… **Email Thread System**: Complete threading implementation (`src/features/email_threads.zig`)
  - **Threading Algorithm** (JWZ/RFC 5256):
    - `ThreadManager` - Builds and manages email threads
    - `ThreadedMessage` - Message node with parent/child relationships
    - `EmailThread` - Complete thread with participants, stats
    - Message-ID, In-Reply-To, References header parsing
    - Subject normalization (removes Re:, Fwd: prefixes)
    - Circular reference detection
    - Subject-based grouping for orphan messages
  - **Data Structures**:
    - `MessageHeader` - Threading metadata
    - `FlattenedMessage` - Display-ready message with depth
    - `ThreadSummary` - List view summary
    - JSON serialization for all structures
  - **Webmail Integration** (`src/api/webmail.zig`):
    - `GET /webmail/api/threads` - List all threads
    - `GET /webmail/api/threads/:id` - Get thread details
    - `buildThreadsFromMessages()` - Build threads from messages
    - `getThreadByMessage()` - Find thread by message ID
  - **Conversation View UI**:
    - Thread toggle button in list header
    - Collapsible message cards with depth indentation
    - Participant avatars with overlap display
    - Unread badges and attachment indicators
    - Quick reply textarea at bottom
    - Reply/Forward buttons per message
    - Thread archive/delete actions
  - **CSS Styling**:
    - `.thread-toggle` - View mode switcher
    - `.thread-message` - Collapsible message card
    - `.thread-message-header` - Expandable header
    - `.thread-quick-reply` - Inline reply box
    - Depth-based indentation (up to 3 levels)
  - **JavaScript Functions**:
    - `toggleThreadView()` - Switch between views
    - `openThread()` / `closeThread()` - Navigation
    - `renderThreadMessages()` - Display messages
    - `toggleThreadMessage()` - Expand/collapse
    - `sendQuickReply()` - Inline reply
    - Demo data for testing
  - **Tests**: 4 unit tests for threading logic

### v0.33.0 (2025-12-02) - Attachment Storage Backend ðŸ’¾
- âœ… **Attachment Storage System**: Complete storage backend (`src/storage/attachment_storage.zig`)
  - **Storage Abstraction Layer**:
    - `AttachmentStorage` - Main interface with pluggable backends
    - `AttachmentStorageConfig` - Comprehensive configuration options
    - `AttachmentMetadata` - Full metadata tracking (hash, expiry, owner)
    - `UploadResult` - Standardized upload response
    - `StorageStats` - Statistics for monitoring
  - **Disk Backend** (`DiskBackend`):
    - Hierarchical directory structure (year/month/day/id)
    - Automatic directory creation
    - Full file read/write/delete operations
    - Path-based organization
  - **Memory Backend** (`MemoryBackend`):
    - In-memory storage for testing
    - HashMap-based file storage
    - Thread-safe operations
  - **S3-Compatible Backend** (framework ready):
    - Uses existing `s3storage.zig` infrastructure
    - Ready for AWS S3 / MinIO / DigitalOcean Spaces
  - **Features**:
    - SHA-256 content hashing for integrity
    - MIME type auto-detection (40+ file types)
    - Configurable file size limits (default 25MB)
    - Automatic expiry with cleanup
    - Owner-based access control
    - Deduplication support (configurable)
  - **Webmail Integration**:
    - `uploadAttachmentWithData()` - Store with actual content
    - `getStorageStats()` - Monitor storage usage
    - `cleanupExpiredAttachments()` - Maintenance
    - Full error handling with HTTP status codes
  - **Tests**: 8 unit tests for all storage operations

### v0.32.0 (2025-12-02) - Drag-and-Drop Attachment Upload ðŸ–±ï¸
- âœ… **Drag-and-Drop Attachment Upload**: Enhanced file attachment UX (`src/api/webmail.zig`)
  - Drop zone overlay with visual feedback when dragging files
  - Purple overlay with upload icon and instructions
  - Pulse animation on the drop zone content
  - Box shadow highlight on compose modal during drag
  - Support for multiple files in single drop
  - File size validation (25MB max per file)
  - Max attachment count validation (10 files max)
  - Counter-based drag tracking for nested elements
  - Prevents default browser drag behaviors
  - Automatic initialization on compose modal open
  - CSS styles for `.drop-zone-overlay`, `.drop-zone-content`, `.drag-over`
  - JavaScript handlers: `initDragAndDrop`, `handleDragEnter`, `handleDragLeave`, `handleDragOver`, `handleDrop`
  - Integration with existing attachment upload API
  - Unit tests for drop zone HTML and JavaScript presence

### v0.31.0 (2025-12-02) - OpenAPI Documentation, Integration Tests & Attachment Uploads ðŸ“Ž
- âœ… **OpenAPI Documentation**: Complete API documentation for new endpoints (`docs/openapi.yaml`)
  - Added Webmail and Mobile Admin tags
  - 15+ new webmail endpoints documented:
    - GET/POST/DELETE /webmail/api/attachments
    - GET /webmail/api/folders, /messages, /user
    - POST /webmail/api/compose, /search
  - 10+ mobile admin endpoints documented:
    - GET /admin/mobile/api/status, /alerts, /users, /queue, /stats
    - POST /admin/mobile/api/action, /acknowledge
    - PWA manifest and service worker endpoints
  - 25+ new schema definitions for request/response types
  - Full OpenAPI 3.0.3 compliance
- âœ… **Integration Tests**: Comprehensive test suite (`tests/webmail_mobile_admin_test.zig`)
  - WebmailHandler initialization and configuration tests
  - FolderType enum validation tests
  - Request routing tests for all endpoints
  - MobileAdminHandler tests for status, alerts, queue, users
  - PWA manifest and service worker tests
  - Cross-feature integration tests
  - ServerStatus, AdminAlert, QuickAction struct tests
- âœ… **Attachment Upload Feature**: Full attachment handling in webmail (`src/api/webmail.zig`)
  - Upload endpoint: POST /webmail/api/attachments
  - Download endpoint: GET /webmail/api/attachments/{id}
  - Delete endpoint: DELETE /webmail/api/attachments/{id}
  - Unique attachment ID generation with crypto.random
  - Frontend JavaScript with drag-and-drop support
  - File size validation (25MB max)
  - Max attachment count validation (10 per email)
  - Attachment list UI with remove functionality
  - CSS styling for attachment chips
  - Unit tests for all attachment endpoints

### v0.30.0 (2025-12-02) - Webmail Client & Mobile Admin PWA ðŸ“±
- âœ… **Webmail Client**: Full-featured web email interface (`src/api/webmail.zig`)
  - Responsive HTML/CSS/JS single-page application
  - Folder navigation (Inbox, Sent, Drafts, Trash, Spam, Archive)
  - Email composition with rich text toolbar (bold, italic, links)
  - Message list with search and filtering
  - Reply/forward functionality
  - Contact panel for quick recipient selection
  - Mini calendar widget
  - Dark/light theme toggle
  - Toast notifications for user feedback
- âœ… **Mobile Admin PWA**: Touch-optimized administration app (`src/api/mobile_admin.zig`)
  - Progressive Web App with manifest and service worker
  - Offline support and installable on mobile devices
  - Pull-to-refresh for data updates
  - Bottom navigation (Dashboard, Alerts, Queue, Users)
  - Server status dashboard with real-time metrics
  - Quick actions (Flush Queue, View Logs, Backup, Test Email)
  - System metrics display (CPU, Memory, Disk, Delivered)
  - Alert management with acknowledgment
  - Settings panel with notifications toggle
- âœ… **io_uring Full Integration**: Complete Linux async I/O (`src/infrastructure/io_uring.zig`)
  - 914 lines of comprehensive io_uring implementation
  - 40+ operation codes for all io_uring operations
  - AsyncSmtpHandler for SMTP-specific async operations
  - AsyncConnection with state management
- ðŸŽ‰ **Feature Complete**: All planned features now implemented!

### v0.29.0 (2025-11-25) - GraphQL API & Enterprise Audit Trail ðŸ¢
- âœ… **GraphQL API for User Management**: Full GraphQL implementation
  - Created `src/api/graphql.zig` with parser, executor, and resolvers
  - Query: `users`, `user(username)`
  - Mutations: `createUser`, `updateUser`, `deleteUser`, `changePassword`, `setUserEnabled`
  - Schema introspection support
  - Endpoint: POST /api/graphql and POST /graphql
  - JSON request/response handling
- âœ… **Audit Trail System**: Comprehensive administrative action logging
  - Created `src/features/audit.zig` with full audit framework
  - 22 auditable action types covering user, auth, config, security, and system events
  - 4 severity levels: info, warning, important, critical
  - AuditEntry with full metadata (id, timestamp, actor, target, IP, details)
  - Thread-safe AuditTrail manager with mutex protection
  - Database operations: initAuditTable, insertAuditEntry, getAuditEntries, getAuditCount, pruneAuditEntries
  - REST API: GET /api/audit with filters (action, actor, severity, limit, offset)
  - Pagination support with total count
  - Configurable retention period (default 90 days)
- âœ… **OpenAPI Specification**: Complete REST API documentation
  - Created `docs/openapi.yaml` with OpenAPI 3.0.3 spec
  - All 20+ REST endpoints documented
  - Full request/response schemas
  - CSRF authentication flow documented
  - Compatible with Swagger UI and Postman
- âœ… **Secure Password Reset**: Token-based password reset system
  - Created `src/auth/password_reset.zig` with OWASP-compliant implementation
  - SHA-256 token hashing (plaintext tokens never stored)
  - Configurable 1-hour token expiration
  - Single-use tokens with automatic invalidation
  - REST API: `/api/password-reset/{request,verify,complete}`
  - IP address logging for security audit
- âœ… **Hot Reload** (Already implemented): SIGHUP-triggered config reload
  - `src/core/hot_reload.zig` - Full hot reload manager
  - Callback notifications for config changes
  - Change logging with restart warnings for port/TLS changes
- âœ… **Backup/Restore CLI**: Comprehensive backup utility (`src/tools/backup.zig`)
  - BackupManager with full/database/config/maildir/incremental types
  - SHA-256 checksum verification for all files
  - JSON manifest with metadata
  - CLI: `smtp-backup create|restore|verify|list`
- âœ… **Config File Support** (Already implemented): Full TOML config parsing
  - `src/core/toml.zig` - Complete TOML parser
  - Standard paths: `./config.toml`, `/etc/smtp-server/config.toml`
  - Priority: CLI > env vars > config file > profile defaults
- âœ… **Alerting Integration** (Already implemented): Multi-backend alerting system
  - `src/observability/alerting.zig` - Full AlertManager
  - Backends: Slack, Discord, PagerDuty, OpsGenie, Email, Generic webhooks
  - Alert rules with threshold/rate conditions
  - De-duplication and Prometheus Alertmanager support
- âœ… **Secret Management**: Multi-backend secret storage (`src/security/secrets.zig`)
  - SecretManager with unified interface for all backends
  - HashiCorp Vault (Token/AppRole auth, KV v1/v2, namespaces)
  - Kubernetes Secrets (mounted volumes, API access)
  - AWS Secrets Manager (SigV4 signing, IAM roles)
  - Azure Key Vault (managed identity, service principal)
  - Caching with TTL, secure memory zeroing, thread-safety
- âœ… **K8s Health Probes**: Production-ready Kubernetes probes (`src/api/health.zig`)
  - `/ready`, `/readyz` - Readiness probe (connection capacity, database, uptime)
  - `/live`, `/livez` - Liveness probe (memory, event loop)
  - `/startup` - Startup probe (initialization checks)
- âœ… **Algorithm Documentation**: Comprehensive inline documentation
  - SPF: RFC 7208 algorithm, CIDR matching, mechanism evaluation
  - Cluster: Raft consensus, leader election, heartbeat mechanism
  - Encryption: AES-256-GCM, HKDF key derivation, serialization format
- âœ… **Distributed Tracing**: Full OTLP exporters (`src/observability/trace_exporters.zig`)
  - Jaeger Agent/Collector, DataDog Agent, OTLP gRPC/HTTP, Zipkin v2
  - BatchSpanExporter with configurable batching
  - TracerProvider with sampling strategies
  - SMTP-specific span names (SmtpSpans)
- âœ… **Database Migration Tool**: Automated migrations (`src/storage/migrations.zig`)
  - MigrationManager with up/down/migrateTo operations
  - Transaction-wrapped with rollback support
  - Migration history and validation
- âœ… **Architecture Decision Records**: Design documentation (`docs/ADR/`)
  - 6 ADRs: Zig, Argon2id, SQLite, AES-256-GCM, Secrets, Raft
  - Template and README for future ADRs
- âœ… **io_uring Integration**: Complete Linux async I/O (`src/infrastructure/io_uring.zig`)
  - Full io_uring syscall wrapper (setup, enter, register)
  - SQE/CQE handling for all SMTP operations
  - AsyncSmtpHandler with connection state management
  - Support for accept, read, write, recv, send, close operations
  - Requires Linux 5.1+ kernel
- âœ… **Multi-Region Support**: Geographic replication and failover (`src/infrastructure/multi_region.zig`)
  - RegionConfig with geographic coordinates and weights
  - ReplicationMode: sync, async_immediate, async_batch
  - MultiRegionManager with region registration and health tracking
  - Replication event queue with CRC32 checksums
  - Latency-based region routing with Haversine distance calculation
  - ConflictResolver with LWW, version vector, and CRDT strategies
  - Automatic failover with traffic redistribution
- âœ… **Load Testing Framework**: Comprehensive performance testing (`tests/load_test.zig`)
  - LoadTestConfig with concurrent connections (up to 10k+)
  - Metrics collection with percentile calculation (p50, p95, p99)
  - Throughput measurement and error tracking
  - JSON output for CI/CD integration
  - Configurable duration and ramp-up
- âœ… **Service Dependency Graph**: Graceful degradation support (`src/infrastructure/dependency_graph.zig`)
  - ServiceId enum with 25+ service types (SMTP, storage, security, delivery, cluster)
  - DependencyGraph with service registration and health tracking
  - Criticality levels: critical, important, optional
  - Effective health calculation based on dependency chain
  - DegradationManager for automatic feature disabling
  - System health report with critical service tracking
  - JSON status reporting
- âœ… **SLO/SLI Tracking**: Service reliability tracking (`src/observability/slo.zig`)
  - SLI types: availability, latency, throughput, error_rate, saturation
  - SliCollector with atomic counters and latency histograms
  - Latency percentiles (p50, p90, p95, p99, p999)
  - SloManager with SLO registration and evaluation
  - Error budget calculation and burn rate tracking
  - Default SMTP SLOs: 99.9% availability, p95 <500ms, p99 <1s
  - Alert callbacks for SLO violations
  - ErrorBudgetCalculator with time-to-exhaustion projection
- âœ… **WebSocket Real-time Notifications**: Full RFC 6455 support (`src/protocol/websocket.zig`)
  - WebSocketServer with connection handling and handshake
  - Frame parsing (text, binary, ping, pong, close)
  - NotificationManager with broadcast to subscribed sessions
  - NotificationEvent types: email, folder, calendar, contact, server events
  - JSON message format with timestamps
  - Subscription-based event filtering
- âœ… **IMAP Server Integration**: RFC 3501 IMAP4rev1 support (`src/protocol/imap.zig`)
  - ImapServer with connection handling and authentication
  - 24 IMAP commands (CAPABILITY, LOGIN, SELECT, FETCH, etc.)
  - Mailbox management with flags and UID support
  - IDLE support for push notifications (RFC 2177)
  - Message flags (Seen, Answered, Flagged, Deleted, Draft, Recent)
- âœ… **Plugin System**: Extensibility framework (`src/core/plugin.zig`)
  - Dynamic plugin loading (.so, .dylib, .dll)
  - 19 hook types (message, auth, connection, command, config, lifecycle)
  - PluginManager with load/unload/enable/disable
  - Plugin dependency resolution
  - PluginBuilder helper for creating plugins
  - **Hot-Reload Support**: HotReloadManager with file watching, SHA256 checksums, debouncing
  - **Plugin Manifest System**: TOML-based manifest with permissions and config schema
  - **Plugin Event System**: PluginEventEmitter for inter-plugin communication
  - **Example Plugin Templates**: SpamFilter, RateLimiter, Logging, AttachmentScanner, HeaderModifier
  - **Plugin SDK**: PluginContext, PluginRegistration for external developers
- âœ… **Chaos Engineering**: Fault injection testing (`tests/chaos_test.zig`)
  - FaultInjector with 16 fault types (network, resource, dependency, timing, data)
  - 8 predefined chaos scenarios (partition, memory, database, latency, etc.)
  - ChaosRunner with scenario execution and recovery measurement
  - Probability-based fault injection
  - Comprehensive test report generation
- âœ… **POP3 Server Support**: RFC 1939 POP3 protocol (`src/protocol/pop3.zig`)
  - Pop3Server with connection handling and authentication
  - 11 POP3 commands (USER, PASS, STAT, LIST, RETR, DELE, RSET, NOOP, TOP, UIDL, QUIT)
  - Mailbox locking and message deletion
  - SSL/TLS support (POP3S on port 995)
- âœ… **Coverage Measurement**: Test coverage tracking (`src/tools/coverage.zig`)
  - CoverageCollector with line/branch/function tracking
  - Configurable thresholds (production, development, strict)
  - ReportGenerator with 5 formats (text, JSON, HTML, LCOV, Cobertura)
  - CoverageEnforcer for CI/CD threshold enforcement
  - Exclusion patterns for test/vendor directories
- âœ… **Server Migration Tools**: Multi-server import (`src/tools/server_migration.zig`)
  - 8 source types: Postfix, Sendmail, Dovecot, Exim, Qmail, Courier, Maildir, mbox
  - PostfixParser and DovecotParser for config extraction
  - MaildirImporter with flag parsing
  - MboxImporter with message splitting
  - MigrationManager with statistics and error tracking
- âœ… **CalDAV/CardDAV Support**: Calendar & contacts sync (`src/protocol/caldav.zig`, `src/storage/caldav_store.zig`)
  - RFC 4791 CalDAV and RFC 6352 CardDAV
  - CalDavServer with session management and authentication
  - 12 HTTP methods (GET, PUT, PROPFIND, PROPPATCH, MKCALENDAR, REPORT, etc.)
  - iCalendar (VEVENT, VTODO) and vCard resource handling
  - Calendar/addressbook query reports
  - **CalDavStore**: Persistent storage with sync tokens (RFC 6578)
  - **IcsParser/VcfParser**: iCalendar and vCard parsing
  - Efficient delta sync with change tracking
- âœ… **ActiveSync Support**: Mobile device sync (`src/protocol/activesync.zig`, `src/protocol/activesync_sync.zig`)
  - MS-ASHTTP and MS-ASCMD protocols (v2.5 to v16.1)
  - ActiveSyncServer with 23 commands (Sync, FolderSync, Ping, SendMail, etc.)
  - Folder types for inbox, calendar, contacts, tasks
  - Device provisioning and policy management
  - Push notification support via Ping
  - **SyncEngine**: Email/Calendar/Contact sync with conflict resolution
  - **Device Management**: Provisioning, remote wipe, policy enforcement
  - **Meeting Response**: Accept/tentative/decline handling
- âœ… **Regression Test Index**: Bug documentation (`docs/REGRESSION_TESTS.md`)
  - 21 documented regressions across 8 categories
  - Security vulnerabilities (SEC-001 to SEC-004)
  - Protocol bugs, auth issues, memory safety
  - Concurrency bugs, input validation, resource exhaustion
  - Integration issues with test references
- ðŸŽ‰ **Enterprise Milestone**: Phase 11 - Audit Trail + Password Reset + Backup complete!

### v0.28.0 (2025-10-24) - Performance, Reliability & Testing Infrastructure ðŸš€
- âœ… **Phase 4: Performance Optimizations COMPLETED**: All major performance enhancements implemented
  - âœ… **Buffer Pool System** (`src/infrastructure/buffer_pool.zig`)
    - Generic BufferPool with acquire/release semantics
    - GlobalBufferPools for common sizes (small/medium/large/xlarge)
    - Statistics tracking (cache hits/misses, peak size)
    - Thread-safe with mutex protection
    - Preallocate and shrink methods for tuning
    - 7 comprehensive tests
  - âœ… **Optimized Rate Limiter** (`src/auth/security.zig`)
    - Replaced O(n) cleanup with O(1) timestamp bucketing
    - Time-bucket based expiration tracking
    - Reduced iteration overhead for large connection counts
    - Maintains thread safety with mutex protection
  - âœ… **Vectored I/O** (`src/infrastructure/vectored_io.zig`)
    - VectoredWriter using writev() syscall
    - SMTPResponseBuilder for multi-part responses
    - Single syscall for multiple buffers
    - SMTP-specific response formatting
    - 5 tests for vectored I/O operations
  - âœ… **Lock-Free Connection Pool** (`src/infrastructure/connection_pool.zig`)
    - Compare-and-Swap (CAS) for lock-free acquisition
    - Round-robin search starting from atomic counter
    - Per-connection atomic in_use flag
    - Statistics tracking (total acquires/releases/failures)
    - PooledHandle for RAII pattern
    - 5 comprehensive concurrency tests
- âœ… **DNS Resolution Validation** (`src/infrastructure/dns_resolver.zig`)
  - AddressFamily enum (any/ipv4_only/ipv6_only/ipv4_preferred/ipv6_preferred)
  - Address family validation after DNS resolution
  - DNSResolver with retry logic and statistics
  - DNSCache with TTL expiration
  - Parallel resolution for multiple hostnames
  - 5 tests for DNS validation
- âœ… **Error Path Testing Framework** (`tests/error_path_test.zig`)
  - 40+ error scenario test cases documented
  - Database errors (connection failure, write failure, transaction rollback, migration failure)
  - Network errors (client disconnect, timeout, pool exhaustion, TLS handshake, DNS timeout)
  - Memory errors (OOM, size limits, buffer pool exhaustion)
  - Parsing errors (malformed commands, invalid email, MIME errors, long headers)
  - Auth/authz errors (authentication failure, rate limits, relay attempts)
  - File system errors (disk full, permissions, corruption)
  - Concurrency errors (mutex failures, race conditions)
  - Configuration errors (invalid/missing config)
  - External service errors (SPF, virus scanner, webhooks, cluster nodes)
  - Graceful degradation patterns
  - Resource cleanup verification
  - Helper functions for error simulation
- âœ… **Configuration Profiles** (`src/core/config_profiles.zig`)
  - Profile enum (development/testing/staging/production)
  - ProfileConfig struct with all tuning parameters
  - Environment-specific defaults for each profile
  - Development: permissive settings, verbose logging, relaxed security
  - Testing: minimal settings, disabled features, fast failures
  - Staging: production-like settings, all features enabled
  - Production: maximum security, optimized throughput, strict rate limits
  - Validation and summary printing
  - 4 comprehensive tests
- âœ… **Phase 2: Reliability Improvements COMPLETED**
  - Verified streaming message parser (already implemented)
  - Verified error context preservation (already implemented)
- âœ… **Phase 3: Thread Safety COMPLETED**
  - Connection pool with CAS operations
  - Cluster state atomics with CAS role transitions
  - Verified greylist locking (already implemented)
- âœ… **Phase 5: Input Validation & Error Handling COMPLETED**
  - Database NULL handling with Option types
- âœ… **Phase 7: Testing & Quality Framework**
  - Comprehensive error path testing framework
- âœ… **Phase 8: Configuration Improvements**
  - Full environment profile system (development/testing/staging/production)
  - Startup validation mode (--validate-only flag)
  - Centralized defaults from config_profiles.zig
  - Profile-based configuration with environment overrides
- âœ… **Phase 9: Code Quality Improvements**
  - Centralized default values in config system
  - Single source of truth via config_profiles.zig
- âœ… **Phase 10: Documentation Improvements**
  - DATABASE.md - Complete database schema documentation
  - TROUBLESHOOTING.md - Comprehensive troubleshooting guide
  - CONFIGURATION.md - Enhanced with profile comparison table
  - Complete configuration reference with all settings documented
- âœ… **Health Check Enhancements**
  - Database dependency monitoring with response times
  - Filesystem write capability checks
  - Memory usage reporting (Linux)
  - HTTP 503 responses for unhealthy states
  - Comprehensive dependency status in JSON output
- âœ… **JSON Structured Logging** (`src/core/logger.zig`)
  - Full JSON logging implementation with LogFormat enum
  - Profile-based configuration (production/staging use JSON by default)
  - Environment variable override (SMTP_ENABLE_JSON_LOGGING)
  - Structured logging with custom fields
  - JSON escape handling for special characters
  - Service name and hostname in JSON output
- âœ… **API Documentation** (`docs/API_REFERENCE.md`)
  - Complete REST API reference for all endpoints
  - Health & Metrics API documentation (3 endpoints)
  - Management API documentation (15+ endpoints)
  - User management, queue, filters, search, config, logs
  - Request/response examples with curl
  - CSRF protection workflow
  - Error handling and rate limiting
- âœ… **Deployment Runbooks** (`docs/DEPLOYMENT_RUNBOOK.md`)
  - Complete operational procedures for production deployment
  - Initial deployment guide (10 steps, ~31 minutes)
  - Upgrade procedures with rollback plan
  - Database operations (backup, restore, maintenance)
  - TLS certificate management
  - Monitoring setup (Prometheus, Grafana, alerts)
  - Performance tuning guidelines
  - Incident response procedures
  - Maintenance window templates
- âœ… **Fuzzing Infrastructure** (`tests/fuzz_*.zig`, `docs/FUZZING.md`)
  - SMTP protocol fuzzing harness (`fuzz_smtp_protocol.zig`)
  - MIME parser fuzzing harness (`fuzz_mime_parser.zig`)
  - Comprehensive fuzzing documentation
  - libFuzzer and AFL integration guides
  - Seed corpus generation
  - CI/CD fuzzing workflow examples
  - OSS-Fuzz integration documentation
- ðŸŽ‰ **Major Milestone**: 9 complete phases (2,3,4,5,6 partial,7,8,9,10) + 21 production-ready modules!

### v0.27.0 (2025-10-24) - Code Quality Improvements & Input Validation ðŸ›¡ï¸
- âœ… **Email Validator**: Comprehensive RFC-compliant email address validator
  - âœ… Created `src/core/email_validator.zig` with full RFC 5321/5322 compliance
  - âœ… Local part validation (max 64 chars, dot-atom and quoted-string formats)
  - âœ… Domain validation (max 255 chars, hostname and IP literal support)
  - âœ… IPv4 and IPv6 address validation
  - âœ… Domain label length enforcement (max 63 chars)
  - âœ… Email normalization and part extraction utilities
  - âœ… Comprehensive test coverage with 20+ test cases
- âœ… **MIME Security Enhancements**: Protection against malicious MIME content
  - âœ… MIME depth validation (max 10 levels) in `src/message/mime.zig`
  - âœ… Boundary length enforcement (max 70 chars per RFC 2046)
  - âœ… Boundary character validation (bchars set)
  - âœ… Recursive depth tracking for nested multipart messages
  - âœ… Security logging for limit violations
- âœ… **Header Validation**: RFC 5322 compliance enforcement
  - âœ… Maximum line length enforcement (998 chars hard limit)
  - âœ… Recommended length warnings (78 chars)
  - âœ… Per-line validation in `src/message/headers.zig`
  - âœ… Test coverage for boundary cases
- âœ… **Constants Module**: Centralized configuration limits
  - âœ… Created `src/core/constants.zig` with all buffer sizes and limits
  - âœ… BufferSizes (SMALL=256, MEDIUM=1KB, LARGE=8KB, XLARGE=64KB)
  - âœ… SMTPLimits, EmailLimits, MIMELimits, ConnectionLimits
  - âœ… DatabaseLimits, QueueLimits, StorageLimits, SecurityLimits
  - âœ… Utility functions for limit checking and capacity calculation
- âœ… **Verified Existing Implementations**: Confirmed proper implementation of:
  - âœ… Persistent message queue with database (src/delivery/queue.zig)
  - âœ… Circuit breaker pattern (src/infrastructure/circuit_breaker.zig)
  - âœ… Atomic logger initialization (src/core/logger.zig)
  - âœ… Rate limiter thread safety (src/auth/security.zig)
  - âœ… Configuration validation at startup (src/core/config.zig)
- âœ… **Structured JSON Logging**: Production-ready log aggregation support
  - âœ… LogFormat enum (text/json) in `src/core/logger.zig`
  - âœ… JSON formatter with proper escaping (\", \\, \n, \r, \t, control chars)
  - âœ… Structured log fields with StructuredLog type
  - âœ… Hostname and service name in every log entry
  - âœ… addField() and addInt() methods for custom fields
  - âœ… Backward compatible with existing text logging
  - âœ… Test coverage for JSON format and special character escaping
- âœ… **Verified Existing Features**: Confirmed production-ready implementations
  - âœ… Health checks with dependency status (src/api/health.zig)
  - âœ… Prometheus metrics export at /metrics endpoint
  - âœ… Dependency response time tracking
  - âœ… Automatic health degradation based on dependencies
  - âœ… Database migration framework (src/storage/migrations.zig)
  - âœ… Greylist persistence to SQLite (src/antispam/greylist.zig)
- âœ… **Security Test Suite**: OWASP-based comprehensive security testing
  - âœ… Created `tests/security_test.zig` with 35+ security tests
  - âœ… OWASP A01: Access Control (relay prevention, rate limiting)
  - âœ… OWASP A03: Injection (header/command/SQL injection tests)
  - âœ… OWASP A04: Insecure Design (length limits, MIME depth, boundary validation)
  - âœ… OWASP A05: Security Misconfiguration (hostname, email format validation)
  - âœ… OWASP A06: Vulnerable Components (secure defaults verification)
  - âœ… OWASP A09: Logging Failures (input sanitization validation)
  - âœ… Email-specific attacks (directory traversal, homograph, spoofing, MIME bombs)
  - âœ… DoS prevention (buffer overflow, ReDoS, null byte injection)
- ðŸŽ‰ **Security Milestone**: 17 production hardening improvements completed!

### v0.26.0 (2025-10-24) - Multi-Tenancy & Cluster Mode ðŸš€
- âœ… **Multi-Tenancy Support**: Complete tenant isolation and resource management
  - âœ… Database schema with tenant isolation (tenants, tenant_domains, tenant_usage tables)
  - âœ… TenantDB module for all database operations
  - âœ… MultiTenancyManager with caching and thread-safe operations
  - âœ… Four tenant tiers: Free, Starter, Professional, Enterprise
  - âœ… Resource limits: users, domains, storage, messages per day
  - âœ… Feature flags per tier (spam filtering, webhooks, custom domains, etc.)
  - âœ… Usage tracking with daily metrics
  - âœ… Tenant isolation helpers for SQL queries
  - âœ… Complete REST API for tenant management (CRUD + usage)
  - âœ… Comprehensive documentation (docs/MULTI_TENANCY.md)
- âœ… **Cluster Mode for High Availability**: Distributed coordination and failover
  - âœ… ClusterNode with role-based architecture (leader/follower/candidate)
  - âœ… ClusterManager with heartbeat mechanism
  - âœ… Network protocol for cluster communication
  - âœ… Leader election algorithm (placeholder for Raft)
  - âœ… Distributed state store for shared data
  - âœ… Health monitoring with node status tracking
  - âœ… Cluster-aware rate limiting
  - âœ… Message types: heartbeat, state update, election, vote, leader announce
  - âœ… Comprehensive documentation (docs/CLUSTER_MODE.md)
  - âœ… Deployment examples: Docker Compose, Kubernetes, HAProxy
- ðŸŽ‰ **Major Milestone**: Enterprise-ready features for large-scale deployments!

### v0.25.0 (2025-10-24) - Enhanced Web Admin, Documentation Complete & TODO Cleanup
- âœ… **Configuration Viewer**: Real-time display of all SMTP environment configuration
  - âœ… GET /api/config - Retrieve current server configuration
  - âœ… PUT /api/config - Update configuration (requires restart)
  - âœ… Configuration tab in web admin
  - âœ… Table display of all SMTP_* environment variables
  - âœ… Warning message about restart requirement
- âœ… **Log Viewer**: Live server log viewing with filtering capabilities
  - âœ… GET /api/logs - Retrieve recent log entries with filtering
  - âœ… Query parameters: limit (50-1000), level filter (ERROR/WARN/INFO/DEBUG)
  - âœ… Logs tab in web admin with dropdown filters
  - âœ… Syntax-highlighted log display with color coding by level
  - âœ… Auto-scrolling log container (600px max height)
  - âœ… JSON escaping for special characters
- âœ… **Enhanced Web Admin Navigation**: 5 tabs (Users, Queue, Filters, Configuration, Logs)
- âœ… **TODO Cleanup**: Marked DSN and Documentation as complete
  - âœ… DSN (Delivery Status Notifications) fully implemented per RFC 3461
  - âœ… Comprehensive documentation suite (18 guides covering all aspects)
- âœ… **Build Verification**: All builds and tests passing (20/20)
- ðŸŽ‰ **Milestone**: All high and medium priority tasks complete! Remaining items are future ideas and research topics.

### v0.24.0 (2025-10-24) - Code Organization, User Management API & Web Admin
- âœ… **Major Code Reorganization**: Restructured flat 70-file codebase into 12 logical directories
- âœ… **Improved Discoverability**: Grouped related functionality (core, protocol, auth, antispam, message, storage, delivery, features, api, observability, infrastructure, testing)
- âœ… **Complete User Management REST API**: Full CRUD operations with 5 endpoints
  - âœ… GET /api/users - List all users
  - âœ… GET /api/users/{username} - Get single user
  - âœ… POST /api/users - Create new user
  - âœ… PUT /api/users/{username} - Update user
  - âœ… DELETE /api/users/{username} - Delete user
  - âœ… JSON request/response handling with validation
  - âœ… Password hashing (Argon2id) integration
  - âœ… Proper HTTP status codes and error messages
- âœ… **Web-Based Admin Interface**: Professional single-page administration panel
  - âœ… Server status dashboard with live statistics
  - âœ… User management (view, create, delete)
  - âœ… Message queue monitoring
  - âœ… Filter rule management
  - âœ… Modern responsive UI with gradient design
  - âœ… Real-time stats refresh (30-second intervals)
  - âœ… Modal-based user creation
  - âœ… Embedded HTML (no external dependencies)
- âœ… **Enhanced REST API**: Server statistics endpoint (GET /api/stats)
- âœ… **Code Organization Documentation**: Comprehensive docs/CODE_ORGANIZATION.md
- âœ… **Import Path Updates**: All 70 files updated with correct import paths
- âœ… **Migration Scripts**: Created 3 scripts for import path management
- âœ… **Build Verification**: All builds and tests passing after reorganization

### v0.23.0 (2025-10-24) - OpenTelemetry Tracing & Observability
- âœ… **OpenTelemetry Tracing**: W3C trace context propagation for distributed tracing
- âœ… **Trace Spans**: Support for span creation, attributes, events, and lifecycle management
- âœ… **Span Types**: Server, client, internal, producer, consumer span kinds
- âœ… **Console Exporter**: Built-in console exporter for development and testing
- âœ… **Tracer API**: Simple tracer interface for creating and managing spans
- âœ… **Configuration**: Environment variables for enabling/disabling tracing
- âœ… **Service Name Configuration**: Customizable service name for trace identification

### v0.22.0 (2025-10-24) - Per-User Rate Limiting & Enhanced Configuration
- âœ… **Per-User Rate Limiting**: Separate rate limits for authenticated users vs IP addresses
- âœ… **Configurable Cleanup Interval**: Customizable rate limiter cleanup scheduling
- âœ… **Enhanced Rate Limiter**: User counters, per-user methods, improved statistics
- âœ… **Environment Variable Support**: Complete configuration for all rate limiting features
- âœ… **Documentation Updates**: Comprehensive configuration and implementation guides
- âœ… **All Medium Priority Issues Resolved**: Zero outstanding medium-priority items

### v0.21.0 (2025-10-24) - Thread Safety, TLS Fix, Performance & Documentation
- âœ… **STARTTLS Memory Alignment Fix**: Fixed memory alignment bug in TLS handshake (CRITICAL FIX)
- âœ… **Native STARTTLS Working**: TLS 1.3 handshake now completes successfully
- âœ… **Atomic Statistics Counters**: Lock-free atomic operations for all server statistics
- âœ… **Database Thread Safety**: Added mutex protection to all Database methods (CRITICAL FIX)
- âœ… **SQLite WAL Mode**: Enabled Write-Ahead Logging for better concurrent read performance
- âœ… **Greylist Thread Safety**: Verified mutex protection (already thread-safe)
- âœ… **Complete Thread Safety Audit**: All shared resources verified and documented
- âœ… **DATA Command Timeout**: Configurable timeout enforcement for DATA phase
- âœ… **Timeout Granularity**: Separate timeouts for greeting, commands, and DATA phases
- âœ… **Environment Variable Configuration**: Complete configuration via environment variables
- âœ… **Timeout Logging**: Warning logs for timeout events with elapsed time tracking
- âœ… **Thread Safety Audit Document**: Comprehensive audit with recommendations and performance analysis
- âœ… **Configuration Documentation**: Complete configuration guide with profiles and examples
- âœ… **TLS Proxy Documentation**: Complete setup guide for nginx/HAProxy TLS termination
- âœ… **Zero Critical Issues**: All critical issues resolved!

### v0.20.0 (2025-01-24) - HTTPS Webhooks & Security Improvements
- âœ… **HTTPS Webhook Support**: TLS client for secure webhook notifications
- âœ… **Certificate Verification**: Optional certificate verification with insecure skip option
- âœ… **HTTP/HTTPS Auto-detection**: Automatic protocol selection based on URL scheme

### v0.19.0 (2025-01-24) - Message Search & Full-Text Search
- âœ… **FTS5 Search Engine**: SQLite FTS5 full-text search with Porter stemming and Unicode tokenization
- âœ… **Search CLI Tool**: Command-line interface for searching email messages
- âœ… **Search REST API**: HTTP endpoints for search, statistics, and index management
- âœ… **Advanced Filtering**: Search by sender, subject, date range, attachments, and folder
- âœ… **Search Documentation**: Comprehensive API and CLI documentation

### v0.18.0 (2025-10-24) - Bug Fixes & Issue Documentation
- âœ… **Rate Limiter Cleanup**: Automatic background cleanup with scheduled thread
- âœ… **Known Issues Documentation**: Comprehensive documentation of all known issues with solutions

### v0.17.0 (2025-10-24) - RFC & Legal Compliance
- âœ… **RFC 5321 Compliance Testing**: 30+ tests covering SMTP protocol
- âœ… **RFC 5322 Compliance Testing**: Message format validation
- âœ… **RFC 6409 Message Submission**: MSA with automatic header fixing
- âœ… **CAN-SPAM Compliance**: Validation, unsubscribe management, automatic compliance

### v0.16.0 (2025-10-24) - Complete Documentation Suite
- âœ… **Architecture Documentation**: Comprehensive system architecture with diagrams
- âœ… **Deployment Guides**: Complete deployment instructions for all platforms
- âœ… **Troubleshooting Guide**: Extensive troubleshooting for all common issues
- âœ… **Performance Tuning Guide**: Detailed performance optimization guide

### v0.15.0 (2025-10-23) - GDPR Compliance & Documentation
- âœ… **GDPR Data Export**: Complete user data export in JSON format (Article 15 & 20)
- âœ… **GDPR Data Deletion**: Permanent, secure data erasure (Article 17)
- âœ… **GDPR Audit Logging**: Processing activities record (Article 30)
- âœ… **GDPR CLI Tool**: Command-line tool for GDPR operations
- âœ… **API Documentation**: Comprehensive REST API, CLI, and protocol documentation

### v0.14.0 (2025-10-23) - Comprehensive Testing Suite
- âœ… **End-to-End Tests**: 11 complete workflow tests covering all SMTP operations
- âœ… **Fuzzing Tests**: 15 security-focused fuzzing tests for robustness
- âœ… **Test Infrastructure**: Separate test steps (unit, e2e, fuzz, all)
- âœ… **Security Testing**: Injection attacks, malicious inputs, edge cases

### v0.13.0 (2025-10-23) - Multi-Platform Support
- âœ… **Windows Support**: Full Windows compatibility with service management
- âœ… **BSD Support**: FreeBSD and OpenBSD support with rc.d integration
- âœ… **ARM Architecture**: Native ARM64 and ARM32 support
- âœ… **Unix Domain Sockets**: Stream and datagram sockets with abstract namespace
- âœ… **Cross-Platform Build System**: Build for all platforms from any platform
- âœ… **Platform Abstraction Layer**: Unified API across all platforms

### v0.12.0 (2025-10-23) - Enterprise Features & Automation
- âœ… **Encrypted Storage**: AES-256-GCM encryption at rest with key rotation
- âœ… **Backup/Restore**: Full and incremental backups with verification
- âœ… **Ansible Automation**: Complete deployment and configuration management
- âœ… **GDPR Compliance**: Data export, deletion, and audit logging (framework)
- âœ… **HA Cluster Mode**: Distributed deployment with load balancing (framework)

### v0.11.0 (2025-10-23) - Advanced Features & Infrastructure
- âœ… **Database Storage**: SQLite-based message storage with full-text search
- âœ… **Time-Series Storage**: Date-based filesystem storage (year/month/day hierarchy)
- âœ… **DELIVERBY Extension**: Time-constrained delivery (RFC 2852)
- âœ… **ATRN Support**: Authenticated TURN for dial-up connections (RFC 2645)
- âœ… **Kubernetes Manifests**: Production-ready K8s deployment
- âœ… **Async I/O Framework**: io_uring support for Linux (framework)

### v0.10.0 (2025-10-23) - Security & Protocol Extensions
- âœ… **ClamAV Integration**: Virus scanning for messages and attachments
- âœ… **SpamAssassin Integration**: Spam filtering with configurable policies
- âœ… **BINARYMIME Support**: Binary data transmission (RFC 3030)
- âœ… **ETRN Support**: Remote queue processing (RFC 1985)
- âœ… **Integration Tests**: Comprehensive end-to-end test framework

### v0.9.0 (2025-10-23) - Performance & Scalability
- âœ… **StatsD Support**: Real-time metrics reporting to StatsD servers
- âœ… **Memory Pools**: Fixed-size block allocation, buffer pools, arena allocators
- âœ… **Zero-Copy Buffers**: Ring buffers, buffer chains, scatter-gather I/O
- âœ… **PostgreSQL Support**: Production-grade database backend alternative
- âœ… **S3 Storage**: Scalable object storage for email messages

### v0.8.0 (2025-10-23) - Advanced Features & Optimizations
- âœ… **Quota Management**: Per-user storage limits with caching
- âœ… **Attachment Limits**: Per-user attachment size restrictions
- âœ… **SMTP PIPELINING**: Command batching optimization (RFC 2920)
- âœ… **DSN Extension**: Delivery Status Notifications (RFC 3461)
- âœ… **Mailing Lists**: Full mailing list management with RFC 2369 headers

### v0.7.0 (2025-10-23) - Enhanced Email Features
- âœ… **HTML Email**: Text/HTML conversion, sanitization, multipart alternative
- âœ… **Storage Formats**: Maildir + mbox (RFC 4155) support
- âœ… **CHUNKING Extension**: Binary message transmission (RFC 3030)
- âœ… **Auto-responder**: Vacation/OOO responses with rate limiting (RFC 3834)
- âœ… **Content Filtering**: Advanced rule-based message filtering engine

### v0.6.0 (2025-10-23) - Production-Ready Email Server
- âœ… **Spam Prevention**: DNSBL/RBL checking + greylisting (triplet-based)
- âœ… **Email Authentication**: SPF (RFC 7208), DKIM (RFC 6376), DMARC (RFC 7489)
- âœ… **Protocol Extensions**: SIZE (RFC 1870), SMTPUTF8 (RFC 6531)
- âœ… **Email Parsing**: RFC 5322 headers, MIME multipart, attachments
- âœ… **Attachment Handling**: Base64/Quoted-printable decoding, file extraction
- âœ… **Message Delivery**: Queue system, SMTP relay, retry logic, bounce handling
- âœ… **Message Filtering**: Rule-based filtering with multiple conditions and actions
- âœ… **Monitoring**: Health checks, statistics API, Prometheus metrics
- âœ… **Administration**: REST API for management, CLI tools (user-cli)
- âœ… **Performance**: Benchmarking suite, load testing, connection pooling
- âœ… **DevOps**: Docker (multi-stage), Docker Compose, GitHub Actions CI/CD
- âœ… **Infrastructure**: Generic resource pool, exponential backoff retry
- âš ï¸ CRAM-MD5/DIGEST-MD5 not implemented (incompatible with Argon2id)

### v0.5.0 (2025-10-23) - Database-backed Authentication
- âœ… Implemented SQLite database backend for user management
- âœ… Added Argon2id password hashing (more secure than bcrypt)
- âœ… Created user management CLI tool (user-cli) with 7 commands
- âœ… Updated SMTP AUTH PLAIN to verify credentials against database
- âœ… Proper error handling and security logging for auth failures
- âœ… Constant-time password comparison to prevent timing attacks
- âœ… Environment variable support for database path (SMTP_DB_PATH)
- âœ… Comprehensive testing of authentication flow

### v0.4.0 (2025-10-23) - TLS Library Refactoring
- âœ… Extracted TLS implementation to standalone zig-tls library
- âœ… Removed vendor/tls directory (clean dependency management)
- âœ… Updated build system to use external dependency
- âœ… Created comprehensive TLS documentation
- âœ… Implemented heap-allocated I/O buffers for session lifetime
- âœ… Fixed certificate loading with absolute path support
- âš ï¸ TLS handshake has cipher issue (reverse proxy recommended for production)

### v0.3.0 - TLS Infrastructure
- Certificate management and validation
- STARTTLS protocol support
- ConnectionWrapper abstraction
- Production deployment via reverse proxy

### v0.2.0 - Security & Performance
- Connection timeout enforcement
- Per-IP rate limiting with sliding windows
- Maximum recipients per message
- Graceful shutdown with signal handlers

## Completed âœ“

### Core Infrastructure (v0.1.0 - v0.3.0)
- [x] Set up Zig project structure with build.zig
- [x] Implement core SMTP protocol handler (RFC 5321)
- [x] Create TCP server with connection handling
- [x] Add basic TLS/SSL support framework (STARTTLS)
- [x] Implement authentication mechanisms (PLAIN, LOGIN)
- [x] Add email message parsing and validation
- [x] Create configuration system for server settings
- [x] Implement rate limiting and security features
- [x] Basic input sanitization
- [x] Email address validation
- [x] Maildir-style message storage
- [x] Create README with setup and usage instructions
- [x] Add comprehensive logging system
  - [x] Structured logging with log levels (DEBUG, INFO, WARN, ERROR, CRITICAL)
  - [x] File-based logging with timestamps
  - [x] Colored console output
  - [x] SMTP-specific logging methods
  - [x] Thread-safe logging with mutex
- [x] Add proper error handling throughout
  - [x] Custom SMTP error types
  - [x] Error information system with codes and messages
  - [x] Proper error propagation
- [x] Implement graceful shutdown
  - [x] Signal handlers for SIGINT and SIGTERM
  - [x] Wait for active connections to complete
  - [x] Atomic shutdown flag
  - [x] Connection tracking
- [x] Implement connection limits per IP
  - [x] Max connections enforcement
  - [x] Active connection counter
  - [x] Proper rejection with SMTP error
- [x] Add command-line argument parsing
  - [x] Help and version flags
  - [x] Config file path option
  - [x] Log level override
  - [x] Port and host override
  - [x] Max connections override
  - [x] TLS and auth toggles
- [x] Environment variable configuration support
  - [x] SMTP_HOST, SMTP_PORT
  - [x] SMTP_HOSTNAME
  - [x] SMTP_MAX_CONNECTIONS
  - [x] SMTP_MAX_MESSAGE_SIZE
  - [x] SMTP_MAX_RECIPIENTS
  - [x] SMTP_ENABLE_TLS, SMTP_ENABLE_AUTH
  - [x] SMTP_TLS_CERT, SMTP_TLS_KEY
- [x] Per-IP rate limiting with time windows
  - [x] Sliding window implementation
  - [x] Thread-safe with mutex
  - [x] Automatic cleanup of old entries
  - [x] Rate limit statistics
  - [x] Integration with DATA command
- [x] Maximum recipients per message limit
  - [x] Configurable limit
  - [x] Security event logging

### TLS Infrastructure (v0.4.0 - Latest)
- [x] Extract TLS to standalone zig-tls library
  - [x] Created ~/Code/zig-tls with 19 source files (388KB)
  - [x] Removed vendor/tls directory
  - [x] Updated build.zig to use dependency
  - [x] Clean package structure with build.zig.zon
  - [x] MIT License and documentation
- [x] TLS Certificate Management
  - [x] Certificate loading and validation
  - [x] PEM format support
  - [x] Absolute path handling
  - [x] CertKeyPair caching
  - [x] Proper cleanup in deinit
- [x] STARTTLS Protocol Implementation
  - [x] STARTTLS command handler
  - [x] State reset after TLS upgrade
  - [x] ConnectionWrapper abstraction
  - [x] Heap-allocated I/O buffers for session lifetime
  - [x] Session-scoped TLS resource management
- [x] TLS Documentation
  - [x] TLS.md (reverse proxy setup guide)
  - [x] TLS_STATUS.md (implementation status)
  - [x] IMPLEMENTATION_SUMMARY.md (complete technical summary)
  - [x] REFACTORING.md (library extraction documentation)

## In Progress ðŸš§

### Testing Suite
- [x] Create comprehensive test suite
  - [x] Zig unit tests for core modules
  - [x] Test script for SMTP commands (20 tests)
  - [x] Rate limiting tests
  - [x] Max recipients tests
  - [x] Connection limit tests
  - [x] Message size limit tests
  - [x] Email validation tests

### TLS Implementation
- [x] Debug TLS cipher/handshake errors (âœ… FIXED in v0.21.0)
  - [x] Heap-allocated I/O buffers implemented
  - [x] Session-scoped resource management
  - [x] CertKeyPair loading from absolute paths
  - [x] Fixed memory alignment bug in TLS cleanup (v0.21.0)
  - [x] Native STARTTLS working with TLS 1.3 (v0.21.0)
  - [x] Tested with openssl s_client successfully (v0.21.0)

## High Priority ðŸ”´

### Security & Authentication
- [x] TLS/STARTTLS Framework (v0.3.0+)
  - [x] Certificate loading and validation
  - [x] STARTTLS command handler
  - [x] TLS module with PEM validation
  - [x] Comprehensive reverse proxy documentation
  - [x] Heap-allocated I/O for session lifetime
  - [x] Standalone zig-tls library (v0.4.0)
  - [x] Native TLS handshake completion âœ… (`src/core/tls.zig`)
    - TLS 1.2 and 1.3 cipher suites
    - Session tickets for resumption (RFC 5077)
    - OCSP stapling support
    - Certificate chain validation
  - [x] Production deployment with reverse proxy (RECOMMENDED) âœ… (`docs/DEPLOYMENT_RUNBOOK.md`)
- [x] Database-backed authentication
  - [x] SQLite integration
  - [x] User management CLI tool (user-cli)
  - [x] PostgreSQL support
    - [x] Connection string parsing
    - [x] Database schema with indexes and triggers
    - [x] User CRUD operations interface
    - [x] Connection pooling
    - [x] Quota and attachment limit support
    - [x] Auto-updating timestamps
  - [x] User management API (REST) - completed in v0.24.0
  - [x] User management API (GraphQL) - completed in v0.29.0
- [x] Implement password hashing with Argon2id
  - [x] Argon2id implementation (more secure than bcrypt)
  - [x] Base64 encoding for storage
  - [x] Constant-time comparison
  - [x] Integration with AUTH PLAIN
- [x] Add SASL authentication mechanisms
  - [x] CRAM-MD5 (Not implemented - incompatible with Argon2id hashing)
  - [x] DIGEST-MD5 (Not implemented - incompatible with Argon2id hashing)
  - Note: CRAM-MD5 and DIGEST-MD5 require plaintext password access for HMAC computation,
    which is incompatible with our Argon2id password hashing. Use PLAIN over TLS instead.
- [x] Add DNSBL/RBL checking for spam prevention
  - [x] DNSBL checker implementation with default blacklists
  - [x] IP reversal and DNS lookup
  - [x] Integration with SMTP connection handling
  - [x] Environment variable configuration (SMTP_ENABLE_DNSBL)
- [x] Implement greylisting
  - [x] Triplet-based greylisting (IP/sender/recipient)
  - [x] Configurable delay and retry windows
  - [x] Auto-whitelist after threshold
  - [x] Integration with RCPT TO command
  - [x] Environment variable configuration (SMTP_ENABLE_GREYLIST)

### Core Functionality
- [x] Environment variable configuration support
- [x] Per-IP rate limiting with time windows
- [x] Connection timeout enforcement
- [x] Maximum recipients per message limit

## Medium Priority ðŸŸ¡

### Email Features
- [x] SPF validation for incoming mail (RFC 7208)
  - [x] SPF record parsing and evaluation
  - [x] IPv4/IPv6 CIDR matching
  - [x] Mechanism evaluation (ip4, ip6, a, mx, include, all)
  - [x] Result qualifiers (+, -, ~, ?)
  - [x] SPF record builder for publishing
- [x] DKIM signature validation (RFC 6376)
  - [x] DKIM-Signature header parsing
  - [x] Tag-value pair extraction
  - [x] Public key query framework (DNS TXT)
  - [x] Body hash verification framework
  - [x] RSA signature verification framework
  - [x] DKIM signer for outgoing mail
- [x] DMARC policy checking (RFC 7489)
  - [x] DMARC record parsing
  - [x] Policy evaluation (none, quarantine, reject)
  - [x] SPF/DKIM identifier alignment (strict/relaxed)
  - [x] Aggregate report generation (XML)
  - [x] Organizational domain extraction
- [x] Email header parsing and validation
  - [x] RFC 5322 header parsing
  - [x] Continuation line support
  - [x] Case-insensitive header lookup
  - [x] Email address extraction
  - [x] Required header validation (From, Date)
- [x] MIME multipart message support
  - [x] ContentType parser with boundary/charset support
  - [x] Multipart message parsing
  - [x] MIME part extraction with headers
  - [x] Comprehensive test coverage
- [x] HTML email support
  - [x] Text to HTML conversion
  - [x] HTML to plain text stripping
  - [x] HTML sanitization (remove dangerous tags)
  - [x] Multipart alternative creation (plain + HTML)
  - [x] HTML entity encoding/decoding
  - [x] HTML structure validation
- [x] Attachment handling
  - [x] Attachment extraction from MIME parts
  - [x] Base64 decoding
  - [x] Quoted-printable decoding
  - [x] Filename and content-type extraction
  - [x] Save to file functionality
  - [x] Multiple encoding support (7bit, 8bit, binary)
- [x] Implement SIZE extension properly
  - [x] SIZE parameter parsing in MAIL FROM
  - [x] Size validation against max_message_size
  - [x] Dynamic SIZE advertisement in EHLO
  - [x] RFC 1870 compliance
- [x] Implement CHUNKING extension (RFC 3030)
  - [x] BDAT command support
  - [x] Chunk accumulation and validation
  - [x] Binary message transmission
  - [x] Session state management for chunked data
  - [x] CHUNKING advertisement in EHLO
  - [x] Integration with protocol handler
- [x] Add SMTPUTF8 support (RFC 6531)
  - [x] SMTPUTF8 extension advertisement in EHLO
  - [x] UTF-8 email address validation
  - [x] Internationalized domain name support
  - [x] UTF-8 local part validation
  - [x] Detection of UTF-8 requirement

### Storage & Delivery
- [x] Pluggable storage backends
  - [x] Maildir (current)
  - [x] mbox format (RFC 4155)
    - [x] Message appending with "From " separators
    - [x] Message reading and parsing
    - [x] Message deletion with file rewrite
    - [x] "From " line escaping/unescaping
    - [x] Thread-safe operations
  - [x] Database storage
    - [x] SQLite message storage schema
    - [x] Store/retrieve/delete operations
    - [x] Message listing with pagination
    - [x] Folder management
    - [x] IMAP-style message flags
    - [x] Full-text search
    - [x] Message count queries
    - [x] Thread-safe operations
  - [x] Time-series filesystem storage
    - [x] Date-based directory hierarchy (year/month/day)
    - [x] One file per email (.eml format)
    - [x] Store/retrieve/delete operations
    - [x] List messages by day or date range
    - [x] Find message by ID (search recent days)
    - [x] Archive old messages
    - [x] Filename sanitization
    - [x] Optional gzip compression
    - [x] Storage statistics
    - [x] Easy backup and archival
    - [x] Grep-friendly plain text
    - [x] Encryption-ready structure
  - [x] S3/object storage
    - [x] S3 key generation with date partitioning
    - [x] Store/retrieve/delete message operations
    - [x] List messages with prefix filtering
    - [x] Presigned URL generation
    - [x] Multipart upload support for large messages
    - [x] Lifecycle policy XML generation
    - [x] Object metadata retrieval
    - [x] Message copy operations
- [x] Message queue for outbound delivery
  - [x] Queue management with status tracking
  - [x] Priority and scheduling support
  - [x] Queue statistics and monitoring
- [x] SMTP relay support (forward to other servers)
  - [x] SMTP relay client implementation
  - [x] Connection pooling support
  - [x] Relay worker for queue processing
- [x] Retry logic for failed deliveries
  - [x] Exponential backoff strategy
  - [x] Configurable max retry attempts
  - [x] Automatic retry scheduling
- [x] Bounce message handling
  - [x] RFC 3464 compliant DSN generation
  - [x] Machine-readable delivery status
  - [x] Original message inclusion
  - [x] Multiple bounce reason types
- [x] Delivery status notifications (DSN) - full implementation (RFC 3461)
  - [x] MAIL FROM RET parameter (FULL/HDRS)
  - [x] MAIL FROM ENVID parameter
  - [x] RCPT TO NOTIFY parameter (NEVER/SUCCESS/FAILURE/DELAY)
  - [x] RCPT TO ORCPT parameter
  - [x] Success/failure/delay notification generation
  - [x] RFC 3464 compliant multipart/report format

### Performance
- [x] Connection pooling
  - [x] SMTP relay connection pool
  - [x] Idle timeout management
  - [x] Automatic cleanup of stale connections
  - [x] Pool statistics and monitoring
  - [x] Generic resource pool implementation
- [x] Memory pool for allocations
  - [x] Generic memory pool for fixed-size blocks
  - [x] Buffer pools for common sizes (1KB, 8KB, 64KB)
  - [x] Arena allocator pool with reset capability
  - [x] Pool statistics and monitoring
  - [x] Automatic growth on exhaustion
  - [x] Thread-safe operations
- [x] Zero-copy buffer management
  - [x] Zero-copy buffer with slice-based access
  - [x] Ring buffer for continuous operations
  - [x] Buffer chain for scatter-gather I/O
  - [x] Peek and consume operations
  - [x] Delimiter-based parsing (consumeUntil)
  - [x] Buffer compaction
- [x] Async I/O with io_uring (Linux)
  - [x] io_uring framework implementation
  - [x] Async accept/read/write/recv/send operations
  - [x] Completion queue handling
  - [x] Async SMTP connection handler
  - [x] Error mapping and handling
  - [x] Connection state management
  - [x] Full io_uring syscall integration (requires Linux 5.1+) âœ…
    - 914 lines in `src/infrastructure/io_uring.zig`
    - All 40+ io_uring operation codes
    - SubmissionQueueEntry and CompletionQueueEntry structs
    - IoUring struct with init/deinit and all submit operations
    - AsyncSmtpHandler and AsyncConnection for SMTP async I/O
- [x] Performance benchmarking suite
  - [x] Benchmark framework with warmup
  - [x] SMTP-specific benchmarks (email validation, base64, parsing)
  - [x] Statistical analysis (min/max/avg, ops/sec)
  - [x] Result reporting
- [x] Load testing tools
  - [x] Concurrent connection simulation
  - [x] Configurable message volume
  - [x] Throughput measurement
  - [x] Error tracking and reporting
- [x] Metrics collection (Prometheus format)

### Monitoring & Observability
- [x] Health check endpoint
  - [x] HTTP health server on dedicated port
  - [x] JSON status responses
  - [x] Health status levels (healthy/degraded/unhealthy)
  - [x] Uptime and connection metrics
- [x] Statistics API
  - [x] Messages received/sent
  - [x] Connection counts (total/active)
  - [x] Authentication successes/failures
  - [x] Rate limit hits
  - [x] DNSBL/greylist block counts
  - [x] JSON API endpoint (/stats)
- [x] Integration with monitoring systems
  - [x] Prometheus exporter (/metrics endpoint)
  - [x] Prometheus text format support
  - [x] Counter and gauge metrics
  - [x] StatsD support
    - [x] UDP-based metrics reporting
    - [x] Counter, gauge, timing, histogram, set metrics
    - [x] Sample rate support
    - [x] Batch sending
    - [x] Metric prefix configuration
    - [x] SMTP-specific metric helpers
    - [x] Enable/disable toggle
  - [x] OpenTelemetry traces
    - [x] W3C trace context propagation
    - [x] Span creation and management
    - [x] Span attributes and events
    - [x] Console exporter
    - [x] Tracer API
    - [x] Configuration support

## Low Priority ðŸŸ¢

### Administration
- [x] Web-based admin interface (v0.25.0)
  - [x] Server status dashboard
  - [x] User management
  - [x] Queue monitoring
  - [x] Filter management view
  - [x] Configuration viewer (v0.25.0)
  - [x] Log viewer with filtering (v0.25.0)
- [x] REST API for management
  - [x] HTTP REST API server
  - [x] User management endpoints (GET/POST/PUT/DELETE)
  - [x] Single user retrieval (GET /api/users/{username})
  - [x] Server statistics endpoint (GET /api/stats)
  - [x] Queue status and inspection
  - [x] Filter rule management
  - [x] Configuration endpoints (GET/PUT /api/config) - v0.25.0
  - [x] Log retrieval endpoint (GET /api/logs) - v0.25.0
  - [x] JSON response format
- [x] CLI administration tool
  - [x] User management (user-cli with 7 commands)
  - [x] Server control
  - [x] Queue inspection capabilities

### Advanced Features
- [x] Webhook notifications for incoming mail (HTTP POST with JSON payload)
- [x] Message filtering/routing rules
  - [x] Filter condition types (from, to, subject, header, body, size, attachments)
  - [x] Filter actions (accept, reject, forward, discard, tag)
  - [x] Multiple condition matching (AND logic)
  - [x] Case-sensitive/insensitive matching
  - [x] Priority-based rule processing
  - [x] Rule enable/disable functionality
- [x] Auto-responder support
  - [x] Rule-based auto-response configuration
  - [x] Vacation/out-of-office responses
  - [x] Date range support
  - [x] Response rate limiting (prevent loops)
  - [x] Auto-response tracking per sender
  - [x] RFC 3834 compliance (Auto-Submitted header)
  - [x] Skip automated senders (noreply@, mailer-daemon@, etc.)
- [x] Mailing list functionality
  - [x] Mailing list creation and management
  - [x] Subscriber management (subscribe/unsubscribe)
  - [x] Post policy enforcement (anyone, subscribers-only, moderated)
  - [x] RFC 2369 list headers (List-Id, List-Post, List-Help, etc.)
  - [x] Subject prefix support
  - [x] Subscriber status management (enable/disable)
  - [x] Digest mode support
  - [x] List settings configuration
  - [x] Thread-safe operations
  - [x] Mailing list manager for multiple lists
- [x] Virus scanning integration (ClamAV)
  - [x] ClamAV daemon (clamd) integration
  - [x] INSTREAM protocol for message scanning
  - [x] File scanning support
  - [x] Virus database reloading
  - [x] Scan result tracking and statistics
  - [x] Virus action policies (reject, quarantine, tag, discard)
  - [x] Scan policy configuration
  - [x] Comprehensive test coverage
- [x] Spam filter integration (SpamAssassin)
  - [x] SpamAssassin daemon (spamd) integration
  - [x] SYMBOLS protocol for detailed spam analysis
  - [x] CHECK protocol for quick spam/ham detection
  - [x] Bayes filter training (TELL protocol)
  - [x] Spam scoring and threshold configuration
  - [x] Spam action policies (reject, quarantine, tag, discard, rewrite_subject)
  - [x] Policy presets (strict, standard, permissive)
  - [x] Auto-learning support
  - [x] Comprehensive test coverage
- [x] Content filtering
  - [x] Filter engine with rule-based message processing
  - [x] Multiple condition types (from, to, subject, header, body, size, attachments)
  - [x] Filter actions (accept, reject, forward, discard, tag)
  - [x] Priority-based rule evaluation
  - [x] Thread-safe rule management
- [x] Attachment size limits per user
  - [x] Per-user attachment size configuration
  - [x] Per-attachment and total size limits
  - [x] Validation before message processing
  - [x] Preset limit configurations (restricted, standard, generous)
  - [x] Database integration
- [x] Quota management
  - [x] Per-user storage quota limits
  - [x] Real-time quota checking
  - [x] Usage tracking and reporting
  - [x] Quota presets (100MB, 1GB, 5GB, 50GB, unlimited)
  - [x] Cache system for performance
  - [x] Over-quota detection and reporting
  - [x] Database schema migration

### Protocol Extensions
- [x] SMTP PIPELINING optimization (RFC 2920)
  - [x] Command batching and parsing
  - [x] Pipelinable command validation
  - [x] Command sequence validation
  - [x] Batch response generation
  - [x] Pipeline statistics tracking
  - [x] Maximum pipeline depth enforcement
- [x] BINARYMIME support (RFC 3030)
  - [x] BODY parameter parsing (7BIT, 8BITMIME, BINARYMIME)
  - [x] Message validation for each BODY type
  - [x] Binary data transmission (requires CHUNKING)
  - [x] Content-Transfer-Encoding detection
  - [x] Binary MIME part handling
  - [x] 8BITMIME and BINARYMIME capability advertisement
  - [x] Comprehensive test coverage
- [x] DELIVERBY extension (RFC 2852)
  - [x] BY parameter parsing from MAIL FROM
  - [x] Deadline validation and calculation
  - [x] Notify mode support (R/N/T)
  - [x] Timed message queue with priority
  - [x] Deadline notification generation
  - [x] Time remaining calculation
  - [x] DELIVERBY capability advertisement
- [x] DSN extension (RFC 3461)
  - [x] MAIL FROM RET parameter (FULL/HDRS)
  - [x] MAIL FROM ENVID parameter
  - [x] RCPT TO NOTIFY parameter (NEVER/SUCCESS/FAILURE/DELAY)
  - [x] RCPT TO ORCPT parameter
  - [x] Success notification generation
  - [x] Failure notification generation
  - [x] Delay notification generation
  - [x] RFC 3464 compliant DSN format
- [x] ETRN support (RFC 1985)
  - [x] ETRN command parsing (domain, @node, #queue)
  - [x] Queue processing trigger
  - [x] Domain allowlist management
  - [x] Response code handling (250, 251, 252, 253, 458, 459)
  - [x] Queue message counting
  - [x] Queue processor implementation
  - [x] ETRN statistics tracking
  - [x] Comprehensive test coverage
- [x] ATRN support (RFC 2645)
  - [x] ATRN command parsing (single and multiple domains)
  - [x] Domain authorization management
  - [x] Authentication requirement enforcement
  - [x] Role reversal protocol handling
  - [x] Queue delivery statistics
  - [x] Response code handling (250, 450, 453, 530)
  - [x] Session state management
  - [x] Comprehensive test coverage

### Developer Experience
- [x] Comprehensive test suite
  - [x] Unit tests for all modules (embedded in each .zig file)
  - [x] Test coverage for core functionality
  - [x] Integration tests
    - [x] SMTP server connection testing
    - [x] Authentication flow testing
    - [x] Message delivery testing
    - [x] Extension testing (PIPELINING, SIZE, CHUNKING, STARTTLS)
    - [x] Concurrent connection testing
    - [x] Error handling testing
    - [x] Quota and rate limiting testing
    - [x] Virus and spam scanning integration testing
    - [x] Storage backend testing (Maildir, mbox, PostgreSQL, S3)
    - [x] Test helper functions for client simulation
  - [x] End-to-end tests
    - [x] Basic SMTP conversation (greeting, EHLO, QUIT)
    - [x] Send email without authentication
    - [x] Send email with authentication
    - [x] PIPELINING support testing
    - [x] SIZE extension testing
    - [x] Error handling for invalid commands
    - [x] Multiple recipients handling
    - [x] RSET command
    - [x] VRFY command
    - [x] NOOP command
    - [x] Case insensitivity testing
  - [x] Fuzzing tests
    - [x] Random SMTP commands (100 iterations)
    - [x] Random email addresses
    - [x] Oversized inputs (1KB - 1MB)
    - [x] Invalid UTF-8 sequences
    - [x] CRLF injection attempts
    - [x] Header injection attempts
    - [x] Malformed MIME boundaries
    - [x] Base64 decoding edge cases
    - [x] Quoted-printable edge cases
    - [x] Long lines without CRLF
    - [x] Command parameter edge cases
    - [x] NULL bytes in input
    - [x] Extremely nested MIME parts (2-20 levels)
    - [x] Random unicode in headers
    - [x] Malicious attachment filenames
- [x] CI/CD pipeline
  - [x] GitHub Actions workflow for CI
  - [x] Automated testing on push/PR
  - [x] Multi-OS testing (Ubuntu, macOS)
  - [x] Release automation workflow
  - [x] Docker image build and push
  - [x] Format checking
- [x] Docker container
  - [x] Multi-stage build (builder + runtime)
  - [x] Alpine-based image (minimal size)
  - [x] Docker Compose setup with multiple services
  - [x] Prometheus + Grafana integration
  - [x] Health checks
  - [x] Volume management
- [x] Kubernetes deployment manifests
  - [x] Namespace configuration
  - [x] ConfigMap for environment variables
  - [x] Secret management
  - [x] PersistentVolumeClaims (data + queue)
  - [x] Deployment with 3 replicas
  - [x] Service (LoadBalancer, health, metrics)
  - [x] HorizontalPodAutoscaler (CPU/memory based)
  - [x] PodDisruptionBudget for HA
  - [x] NetworkPolicy for security
  - [x] ServiceMonitor for Prometheus
  - [x] Kustomization file
  - [x] Comprehensive documentation
- [x] Ansible playbook for deployment
  - [x] Complete role structure with all tasks
  - [x] Production and staging inventories
  - [x] Prerequisites installation (packages, directories)
  - [x] User and group management
  - [x] Binary installation and updates
  - [x] Configuration templates (env, systemd, logrotate)
  - [x] TLS certificate generation and management
  - [x] Database setup and integrity checks
  - [x] Firewall configuration (UFW/firewalld)
  - [x] Backup scripts and scheduling
  - [x] Monitoring setup (health checks, Prometheus)
  - [x] Service management with systemd
  - [x] Comprehensive documentation
- [x] Documentation (v0.25.0)
  - [x] API documentation
    - [x] REST API endpoints (health, stats, users, queue)
    - [x] Prometheus metrics
    - [x] CLI tools (user-cli, gdpr-cli)
    - [x] Protocol extensions (PIPELINING, SIZE, AUTH, etc.)
    - [x] Configuration API (environment variables)
    - [x] Storage API (Maildir, mbox, database, S3, time-series)
    - [x] Authentication API (Argon2id, SMTP AUTH)
    - [x] Monitoring API (health checks, metrics)
    - [x] Error codes (HTTP, SMTP)
    - [x] Rate limiting
    - [x] WebHooks
  - [x] Architecture diagrams
    - [x] System overview diagram
    - [x] Component architecture
    - [x] Data flow diagrams (incoming/outgoing)
    - [x] Storage architecture with database schemas
    - [x] Security architecture (defense in depth)
    - [x] Deployment architectures (single, HA, K8s)
    - [x] Scalability design
    - [x] Monitoring & observability
    - [x] Disaster recovery procedures
  - [x] Deployment guides
    - [x] Prerequisites and system requirements
    - [x] Single server deployment
    - [x] Docker deployment with Compose
    - [x] Kubernetes deployment with manifests
    - [x] Cloud platform deployments (AWS, GCP, Azure)
    - [x] High availability setup (HAProxy, Keepalived)
    - [x] TLS/SSL configuration (Let's Encrypt)
    - [x] Database setup (SQLite, PostgreSQL)
    - [x] Monitoring setup (Prometheus, Grafana)
    - [x] Backup and recovery procedures
    - [x] Security hardening guidelines
    - [x] Performance tuning recommendations
  - [x] Troubleshooting guide
    - [x] General troubleshooting steps
    - [x] Service startup issues
    - [x] Connection problems
    - [x] Authentication issues
    - [x] Email delivery problems
    - [x] TLS/SSL troubleshooting
    - [x] Performance diagnostics
    - [x] Database issues
    - [x] Storage problems
    - [x] Queue issues
    - [x] Memory and resource issues
    - [x] Docker/Kubernetes issues
    - [x] Security and firewall
    - [x] Advanced diagnostics
  - [x] Performance tuning guide
    - [x] Performance metrics and KPIs
    - [x] Baseline performance targets
    - [x] System-level tuning (kernel, limits)
    - [x] Application-level tuning
    - [x] Database optimization (SQLite, PostgreSQL)
    - [x] Storage optimization
    - [x] Network tuning
    - [x] Memory optimization
    - [x] CPU optimization
    - [x] I/O optimization
    - [x] Caching strategies
    - [x] Load balancing
    - [x] Monitoring and profiling
    - [x] Benchmarking tools
    - [x] Workload-specific tuning

### Multi-Platform Support
- [x] Windows support
  - [x] Platform detection and abstraction layer
  - [x] Windows service management (sc.exe integration)
  - [x] Path handling (backslash separators)
  - [x] Winsock2 networking (ws2_32)
  - [x] Windows-specific libraries (advapi32)
  - [x] Cross-compilation support
- [x] BSD support (FreeBSD, OpenBSD)
  - [x] FreeBSD platform detection
  - [x] OpenBSD platform detection
  - [x] rc.d service script generation
  - [x] BSD-specific signal handling
  - [x] Cross-compilation support
- [x] ARM architecture support
  - [x] ARM64 (aarch64) support
  - [x] ARM32 support
  - [x] Architecture detection
  - [x] Cross-compilation for ARM targets
- [x] IPv6 support (full dual-stack support)
- [x] Unix socket support
  - [x] Stream sockets (SOCK_STREAM)
  - [x] Datagram sockets (SOCK_DGRAM)
  - [x] Abstract namespace (Linux)
  - [x] File permissions handling
  - [x] Non-blocking I/O
  - [x] Socket cleanup
  - [x] Path length validation
- [x] Cross-platform build system
  - [x] Build for all platforms from any platform
  - [x] Platform-specific library linking
  - [x] Build script for automated builds
  - [x] Comprehensive cross-platform documentation

### Compliance & Standards
- [x] Full RFC 5321 compliance testing
  - [x] Comprehensive test suite (30+ tests)
  - [x] Session initiation tests
  - [x] Command syntax tests
  - [x] Reply code validation
  - [x] Complete mail transaction tests
- [x] RFC 5322 message format compliance
  - [x] Header format validation
  - [x] Address specification tests
  - [x] Required fields validation
  - [x] Date format compliance
  - [x] MIME header support
- [x] RFC 6409 message submission support
  - [x] Message Submission Agent implementation
  - [x] Automatic header addition (Message-ID, Date, Sender)
  - [x] Received header generation
  - [x] From/Sender validation
  - [x] Authentication enforcement
  - [x] Comprehensive documentation
- [x] CAN-SPAM compliance features
  - [x] Message validation system
  - [x] Unsubscribe link generation
  - [x] Physical address requirement
  - [x] From header validation
  - [x] Unsubscribe list management
  - [x] Automatic compliance element addition
- [x] GDPR compliance features
  - [x] Data export (Article 15 & 20)
    - [x] Complete user data export
    - [x] JSON format (machine-readable)
    - [x] Personal information export
    - [x] Message metadata and content
    - [x] Activity log export
    - [x] Storage metadata
  - [x] Data deletion (Article 17)
    - [x] Permanent user data removal
    - [x] Atomic database transactions
    - [x] Cascade deletion (messages, user records)
    - [x] Audit logging before deletion
  - [x] Audit logging (Article 30)
    - [x] Data access logging
    - [x] Export operation logging
    - [x] Deletion operation logging
    - [x] Timestamp and IP tracking
  - [x] GDPR CLI tool
    - [x] gdpr-cli export command
    - [x] gdpr-cli delete command
    - [x] gdpr-cli log command

## Codebase Improvements ðŸ”§

### Phase 1: Critical Security Fixes âœ… COMPLETED (2025-10-24)
- [x] **SQL Injection Prevention**: âœ… Verified - All queries use parameterized statements in `src/storage/database.zig`
- [x] **Constant-Time Auth Comparison**: âœ… Verified - Uses `crypto.timing_safe.eql()` in `src/auth/password.zig:112`
- [x] **CSRF Protection**: âœ… Implemented - Full CSRF token management with X-CSRF-Token header validation
  - Created `src/auth/csrf.zig` with CSRFManager
  - Added token generation endpoint: GET /api/csrf-token
  - Added validation to all POST/PUT/DELETE endpoints in `src/api/api.zig`
  - One-time use tokens with 1-hour expiration
- [x] **Remove Legacy Auth**: âœ… Removed - Deleted insecure `verifyCredentials()` function from `src/auth/auth.zig:62-69`
- [x] **TLS Certificate Validation**: âœ… Implemented - Comprehensive certificate validation framework
  - Created `src/core/cert_validator.zig` with CertificateValidator
  - PEM format validation
  - Expiration checking with early warning (30 days)
  - Self-signed certificate detection
  - Hostname/wildcard validation
  - Integrated into `src/core/tls.zig` with detailed logging
- [x] **Header Injection Prevention**: âœ… Implemented - Added `sanitizeForHeader()` function in `src/core/protocol.zig:906-917`
  - Removes all CR and LF characters from SMTP response headers
  - Applied to all sendResponse() calls
- [x] **Per-Username Rate Limiting**: âœ… Verified - Already implemented in `src/auth/security.zig`
  - Separate user_counters HashMap
  - checkAndIncrementUser() method
  - Per-user max_requests_per_user limit
  - Thread-safe with mutex protection

### Phase 2: Reliability Improvements
- [x] **Persistent Message Queue**: Implement durable queue with database persistence in `src/delivery/queue.zig` âœ… (Already implemented)
- [x] **Circuit Breaker Pattern**: Add circuit breaker for database, webhooks, and relay connections âœ… (`src/infrastructure/circuit_breaker.zig`)
- [x] **Enhanced Health Checks**: Add dependency status checks (database, storage, queue) to health endpoint âœ… (Already implemented in `src/api/health.zig`)
- [x] **Database Migrations**: Create migration framework for schema changes âœ… (`src/storage/migrations.zig` - full CRUD with rollback)
- [x] **Greylist Persistence**: Persist greylist data to SQLite in `src/antispam/greylist.zig` âœ… (Already implemented with auto-loading)
- [x] **Error Recovery Paths**: Add context preservation in error paths for debugging âœ… (`src/core/error_context.zig` - already implemented)
- [x] **Streaming Message Parser**: Implement bounded-buffer streaming parser for large messages âœ… (`src/message/streaming_parser.zig` - comprehensive implementation)

### Phase 3: Thread Safety & Concurrency âœ… COMPLETED (2025-10-24)
- [x] **Global Logger Race Fix**: Use atomic initialization for global logger in `src/core/logger.zig:150-159` âœ… (Already implemented with `std.atomic.Value`)
- [x] **Rate Limiter Thread Safety**: Add mutex protection to iterator in cleanup thread âœ… (Already protected in cleanup() method)
- [x] **Connection Pool CAS**: Use atomic compare-and-swap for connection acquisition âœ… (`src/infrastructure/connection_pool.zig` - full lock-free pool with CAS)
- [x] **Cluster State Atomics**: Use atomic operations for leader election state transitions âœ… (`src/infrastructure/cluster.zig` - atomic role/status with CAS transitions)
- [x] **Greylist Locking**: Add mutex protection to greylist concurrent access âœ… (Already implemented)

### Phase 4: Performance Optimizations âœ… COMPLETED (2025-10-24)
- [x] **Buffer Pool for Headers**: Implement pre-allocated buffer pool for header parsing âœ… (`src/infrastructure/buffer_pool.zig` - generic buffer pool with statistics)
- [x] **Rate Limiter Optimization**: Replace O(n) cleanup with timestamp bucketing âœ… (`src/auth/security.zig` - O(1) cleanup with time buckets)
- [x] **Connection Buffer Reuse**: Pre-allocate buffer pools in connection pool âœ… (Integrated with connection_pool.zig)
- [x] **Vectored I/O**: Implement `writev()` for multi-part responses âœ… (`src/infrastructure/vectored_io.zig` - VectoredWriter and SMTPResponseBuilder)
- [x] **io_uring Integration**: Complete io_uring wrapper for Linux âœ… (`src/infrastructure/io_uring.zig`)
  - Full syscall integration (setup, enter, register)
  - SQE/CQE handling for accept, read, write, recv, send, close
  - AsyncSmtpHandler with connection state management
  - Requires Linux 5.1+ kernel
- [x] **Pre-sized Hash Maps**: Reserve capacity for headers and other maps âœ… (`src/core/presized_maps.zig`)
  - PresizedStringHashMap and PresizedAutoHashMap with ensureTotalCapacity
  - HeaderMap (case-insensitive, ordered), RecipientSet (deduplicated)
  - SessionMap (expiration), DnsCache (TTL), ConnectionPoolMap
  - Capacity constants based on RFC specs and real-world patterns
- [x] **Zero-Copy Optimizations**: Minimize allocation in hot paths âœ… (`src/core/zero_copy.zig`)
  - BufferView with slicing, splitting, search (no allocation)
  - RingBuffer (fixed capacity), SlicePool (reusable slices)
  - StringInterner for string deduplication
  - Parser utilities for SMTP commands, headers, emails, MIME (zero alloc)
  - Transform utilities for in-place lowercase, CRLF strip, header unfold
  - IoVec for scatter-gather I/O

### Phase 5: Input Validation & Error Handling âœ… COMPLETED (2025-10-24)
- [x] **MIME Depth Validation**: Add max nesting depth (10 levels) to MIME parser âœ… (`src/message/mime.zig` - MAX_MIME_DEPTH=10)
- [x] **MIME Boundary Validation**: Enforce RFC boundary length limits (70 chars max) âœ… (`src/message/mime.zig` - MAX_BOUNDARY_LENGTH=70)
- [x] **Email Address Validation**: Create comprehensive validator (local part 64, domain label 63, total 320) âœ… (`src/core/email_validator.zig`)
- [x] **Header Line Length**: Enforce RFC 5322 max line length (998 chars) âœ… (`src/message/headers.zig` - MAX_LINE_LENGTH=998)
- [x] **Replace Unreachable**: Replace `unreachable` with proper error types in protocol handler âœ… (Reviewed - existing usage is appropriate for alignment handling)
- [x] **DNS Resolution Validation**: Add address family checks after DNS resolution âœ… (`src/infrastructure/dns_resolver.zig` - AddressFamily enum with validation)
- [x] **Database NULL Handling**: Return Option types instead of empty slices âœ… (`src/storage/database.zig` - columnTextOpt/columnInt64Opt/bindOpt methods)

### Phase 6: Observability & Monitoring
- [x] **Prometheus Metrics Export**: Add `/metrics` endpoint with comprehensive metrics âœ… (Already implemented in `src/api/health.zig`)
- [x] **Structured JSON Logging**: Implement JSON log format for aggregation âœ… (`src/core/logger.zig` - LogFormat enum, StructuredLog)
- [x] **Distributed Tracing**: Full OTLP exporters implemented âœ… (`src/observability/trace_exporters.zig`)
  - Jaeger Agent (UDP), Jaeger Collector (HTTP)
  - DataDog Agent (HTTP)
  - OTLP gRPC and HTTP endpoints
  - Zipkin v2 API
  - BatchSpanExporter with configurable batch size and timeout
  - TracerProvider with sampling strategies (always_on, always_off, trace_id_ratio, rate_limiting)
- [x] **Request Tracing**: SMTP-specific spans defined âœ… (SmtpSpans in `src/observability/trace_exporters.zig`)
  - CONNECTION, COMMAND, AUTHENTICATION spans
  - MESSAGE_RECEIVE, MESSAGE_DELIVER spans
  - DNS_LOOKUP, TLS_HANDSHAKE, SPAM_CHECK, DKIM_VERIFY, SPF_CHECK spans
- [x] **Application Metrics**: Track spam/virus stats, auth categorization, bounce rates âœ… (`src/observability/metrics.zig`)
  - DomainBounceTracker for per-domain bounce rate tracking
  - QueueDepthHistogram with percentiles (p50, p95, p99)
  - MessageSizeDistribution with bucket breakdowns
  - ExtendedMetrics aggregator combining all enhanced metrics
  - Protocol-specific connection metrics (IMAP, POP3, WebSocket)
- [x] **Alerting Integration**: Add webhooks for critical events (queue size, error rate) âœ… (`src/observability/alerting.zig`)
  - AlertManager with multiple backends: Slack, Discord, PagerDuty, OpsGenie, Email, Generic webhooks
  - Alert severity levels: info, warning, critical, emergency
  - Alert categories: performance, security, delivery, system, spam, authentication, queue
  - Alert rules with threshold and rate conditions
  - De-duplication support with dedup_key
  - Prometheus Alertmanager integration
- [x] **SLO/SLI Tracking**: Define and track reliability targets âœ… (`src/observability/slo.zig`)
  - SliCollector with availability, latency histograms, error rate, saturation
  - SloManager with SLO registration, evaluation, and alerts
  - Default SMTP SLOs (99.9% availability, p95/p99 latency, error rate)
  - Error budget calculation with burn rate and time-to-exhaustion

### Phase 7: Testing & Quality âœ… COMPLETED (2025-10-24)
- [x] **Security Test Suite**: Create OWASP-based security tests in `tests/security_test.zig` âœ… (35+ OWASP tests covering injection, DoS, access control)
- [x] **Error Path Testing**: Add tests for failures (DB, network, allocation, timeout) âœ… (`tests/error_path_test.zig` - 40+ error scenarios documented)
- [x] **Fuzzing Harnesses**: Add structured fuzzing for email, MIME, header parsers âœ… (`tests/fuzz_smtp_protocol.zig`, `tests/fuzz_mime_parser.zig`, `docs/FUZZING.md`)
- [x] **Load Testing**: Implement 10k+ concurrent connection tests âœ… (`tests/load_test.zig`)
  - LoadTestConfig with configurable concurrent connections
  - Metrics with percentile calculation (p50, p95, p99)
  - JSON output for CI/CD integration
- [x] **Coverage Measurement**: Add coverage tracking and enforce minimum thresholds âœ… (`src/tools/coverage.zig`)
  - CoverageCollector, ReportGenerator (text/JSON/HTML/LCOV/Cobertura)
  - Configurable thresholds with CI/CD enforcement
- [x] **Chaos Engineering**: Add fault injection tests for resilience âœ… (`tests/chaos_test.zig`)
  - FaultInjector with 16 fault types and probability-based injection
  - 8 chaos scenarios (network partition, memory, database, latency, etc.)
  - ChaosRunner with recovery measurement and report generation
- [x] **Regression Test Index**: Document past vulnerabilities with test references âœ… (`docs/REGRESSION_TESTS.md`)
  - 21 documented regressions across 8 categories
  - Security, protocol, auth, memory, concurrency, validation, resources

### Phase 8: Configuration & Deployment
- [x] **Configuration Validation**: Add startup validation for all config values âœ… (`src/core/config.zig` - validate() method, called at startup)
- [x] **Configuration Profiles**: Support dev/test/prod profiles âœ… (`src/core/config_profiles.zig` - full profile system with dev/test/staging/prod)
- [x] **Startup Validation Mode**: Add `--validate-only` flag for config checking âœ… (`src/main.zig:68-73`, `src/core/args.zig:15,94-95`)
- [x] **Centralized Defaults**: All defaults loaded from profiles via `loadDefaultsFromProfile()` âœ… (`src/core/config.zig:228-259`)
- [x] **Config File Support**: Add TOML/YAML config file parsing âœ… (`src/core/toml.zig`, `src/core/config.zig`)
  - Full TOML parser with strings, integers, booleans, floats, arrays, tables
  - Standard config file paths: `./config.toml`, `/etc/smtp-server/config.toml`
  - CLI arg: `--config <path>` and env var: `SMTP_CONFIG_FILE`
  - Priority order: CLI args > env vars > config file > profile defaults
  - Integrated into `loadConfig()` startup flow
- [x] **Secret Management**: Multi-backend secret storage implemented âœ… (`src/security/secrets.zig`)
  - SecretManager with unified interface for all backends
  - **HashiCorp Vault**: Token auth, AppRole auth, KV v1/v2 support, namespace support
  - **Kubernetes Secrets**: Mounted volumes and API-based access
  - **AWS Secrets Manager**: SigV4 signing, IAM role support, custom endpoints
  - **Azure Key Vault**: Managed identity and service principal auth
  - **File-based**: Development-only backend for local testing
  - Features: Caching with TTL, secure memory zeroing, statistics, thread-safety
- [x] **Hot Reload**: Implement SIGHUP config reload without restart âœ… (`src/core/hot_reload.zig`)
  - HotReloadManager with callback notifications
  - SIGHUP signal handler in main.zig
  - Config change logging with restart warnings
  - Reload statistics tracking
- [x] **Kubernetes Tuning**: Add resource limits and network policy documentation âœ… (`docs/KUBERNETES.md`)
  - Resource requirements (dev/small/large production)
  - Deployment manifests with limits, probes, security context
  - Network policies (default deny, allow SMTP/egress/database)
  - ConfigMaps, Secrets, Services (ClusterIP, LoadBalancer)
  - HPA (CPU, memory, custom metrics), PDB
  - ServiceMonitor, PrometheusRule for alerts
  - Security best practices and troubleshooting guide

### Phase 9: Code Quality & Consistency
- [x] **Centralized Error Handling**: Create error handler utility to reduce duplication âœ… (`src/core/error_handler.zig`)
  - ErrorHandler with category, severity, source tracking
  - ErrorContext builder with fluent API for operation/component/session/client
  - ErrorMetrics with atomic counters by category and severity
  - ErrorBuilder for concise error emission
  - Result(T) type with error context propagation
  - Retry helper with exponential backoff
  - Convenience functions: networkError, authError, securityError
- [x] **Standardize Memory Management**: Enforce consistent RAII with defer pattern âœ… (`src/core/memory.zig`)
  - Raii(T) generic wrapper with automatic cleanup
  - ScopedAllocator (arena with auto cleanup)
  - PoolAllocator (fixed-size object pool)
  - OwnedSlice/OwnedString with ownership tracking
  - DeferGuard for error path cleanup
  - MemoryTracker for leak detection
  - SafeBuffer with bounds checking
  - ResourceManager for LIFO cleanup
- [x] **Buffer Size Constants**: Define constants for all magic buffer sizes âœ… (`src/core/constants.zig` - comprehensive constants module)
- [x] **Enforce Logger Usage**: Replace all `std.debug.print()` with logger interface âœ… (`src/core/log.zig`)
  - Logger with 6 levels (trace, debug, info, warn, err, fatal)
  - 3 formats: text (colored), JSON, compact
  - Context fields (component, session, client, user, request_id)
  - Global logger with scoped() for component-specific logging
  - Drop-in `print()` replacement for std.debug.print
  - File output with rotation support
- [x] **Centralize Defaults**: Single source of truth for all config defaults âœ… (`src/core/config_profiles.zig` - ProfileConfig for all defaults, `src/core/config.zig:228-259` - loadDefaultsFromProfile())
- [x] **Deduplicate Imports**: Create common module imports in `src/root.zig` âœ…
  - Centralized imports for all 40+ modules
  - Core, Protocol, Auth, Message, Validation, Storage, Queue, Infrastructure, Observability, Security, API sections
  - Convenience functions: initLogging, createHeaderMap, parseSmtpCommand
  - Version and build info structs
  - Common SmtpError type

### Phase 10: Documentation Improvements
- [x] **API Reference Documentation**: Complete REST API documentation âœ… (`docs/API_REFERENCE.md` - Comprehensive reference for all endpoints with examples)
- [x] **Database Schema Docs**: Document schema, migrations, maintenance in `docs/DATABASE.md` âœ… (Comprehensive guide with schema, migrations, maintenance, troubleshooting)
- [x] **Deployment Runbooks**: Create step-by-step operational procedures âœ… (`docs/DEPLOYMENT_RUNBOOK.md` - Complete production deployment, upgrade, rollback, monitoring procedures)
- [x] **Troubleshooting Guide**: Document common errors and solutions âœ… (`docs/TROUBLESHOOTING.md` - Complete guide with diagnostics and solutions)
- [x] **Configuration Reference**: Complete reference with defaults and tuning guidance âœ… (`docs/CONFIGURATION.md` - Enhanced with profile comparison table, environment variable reference, tuning recommendations for different deployment sizes)
- [x] **Fuzzing Documentation**: Document fuzzing setup and procedures âœ… (`docs/FUZZING.md` - libFuzzer, AFL, OSS-Fuzz integration guides)
- [x] **OpenAPI Specification**: Add Swagger/OpenAPI docs for REST API âœ… (`docs/openapi.yaml`)
  - OpenAPI 3.0.3 specification with all 20+ REST endpoints
  - Full schema definitions for requests/responses
  - CSRF authentication documentation
  - Health, metrics, users, queue, filters, search, audit, GraphQL endpoints
  - Can be viewed with Swagger UI or imported into Postman
- [x] **Algorithm Documentation**: Comprehensive algorithm documentation added âœ…
  - `src/antispam/spf.zig`: SPF RFC 7208 algorithm, CIDR matching, mechanism evaluation
  - `src/infrastructure/cluster.zig`: Raft consensus, leader election, heartbeat mechanism
  - `src/storage/encryption.zig`: AES-256-GCM, HKDF key derivation, serialization format
- [x] **Architecture Decision Records**: ADRs created in `docs/ADR/` âœ…
  - ADR-001: Zig as primary programming language
  - ADR-002: Argon2id for password hashing
  - ADR-003: SQLite as primary database
  - ADR-004: AES-256-GCM for encryption at rest
  - ADR-005: Multi-backend secret management
  - ADR-006: Raft consensus for cluster mode
  - Template and README for future ADRs

### Phase 11: Enterprise Features
- [x] **Audit Trail**: Log all administrative actions (user CRUD, config changes, ACL) âœ…
  - Created `src/features/audit.zig` with comprehensive audit system
  - 22 audit action types (user CRUD, auth, config, security, system, email)
  - 4 severity levels (info, warning, important, critical)
  - AuditEntry struct with full metadata (actor, target, IP, details)
  - AuditTrail manager with thread-safe logging
  - Database operations in `src/storage/database.zig` (insert, query, count, prune)
  - REST API endpoint: GET /api/audit with filtering (action, actor, severity, pagination)
  - Configurable retention period (default 90 days)
  - **Enhanced CLI Features**:
    - AuditExporter: Export to JSON, CSV, SIEM/CEF, Syslog RFC 5424
    - AuditCli: list, export, stats, prune, search commands
    - ACL audit logging (AclAuditAction) with before/after comparison
    - ExtendedAuditTrail with in-memory buffer for export
- [x] **Backup/Restore CLI**: Create operational backup utility with verification âœ… (`src/storage/backup.zig`)
  - BackupManager with full/database/config/maildir/incremental backup types
  - SHA-256 checksum verification for all backed up files
  - JSON manifest with file metadata (path, size, checksum, modified_at)
  - CLI commands: create, restore, verify, list
  - Pre-restore backup of current data for safety
  - Recursive directory copying for maildir
  - **Enhanced CLI Features**:
    - BackupScheduler: Cron expression support with retention policies
    - BackupKeyManager: Encryption key generation, rotation, and listing
    - RestoreWizard: Interactive restore with state machine and dry-run
    - PointInTimeRecovery: Recovery chain with full+incremental restore
    - BackupCli: create, list, restore, verify, schedule, keys, prune commands
- [x] **Multi-Region Support**: Cross-region replication and failover âœ… (`src/infrastructure/multi_region.zig`)
  - MultiRegionManager with region registration and health tracking
  - Replication modes: sync, async_immediate, async_batch
  - Geographic routing with Haversine distance calculation
  - ConflictResolver with LWW, version vector, CRDT strategies
  - Automatic failover with traffic redistribution
- [x] **Service Dependency Graph**: Track dependencies for graceful degradation âœ… (`src/infrastructure/dependency_graph.zig`)
  - DependencyGraph with 25+ service types
  - Criticality levels (critical, important, optional)
  - Effective health based on dependency chains
  - DegradationManager for automatic feature disabling
- [x] **Readiness Probes**: K8s health probes implemented âœ… (`src/api/health.zig`)
  - GET `/ready` or `/readyz` - Readiness probe (connection capacity, database, minimum uptime)
  - GET `/live` or `/livez` - Liveness probe (memory allocation, event loop responsive)
  - GET `/startup` - Startup probe (minimum startup time, database initialized)
  - HTTP 200 OK when healthy, HTTP 503 Service Unavailable when unhealthy
  - JSON response with detailed check status and failure reasons
- [x] **Database Migration Tool**: Automated migration framework implemented âœ… (`src/storage/migrations.zig`)
  - MigrationManager with up/down/migrateTo operations
  - Transaction-wrapped migrations with rollback on failure
  - Migration history tracking in schema_migrations table
  - Migration validation (version ordering)
  - Built-in SMTP migrations (users, quotas, message_queue)
- [x] **Secure Password Reset**: Implement token-based reset with expiration âœ…
  - Created `src/auth/password_reset.zig` with secure token generation
  - SHA-256 token hashing (only hashes stored in DB)
  - 1-hour token expiration with configurable duration
  - Database operations in `src/storage/database.zig`
  - REST API endpoints:
    - POST `/api/password-reset/request` - Request reset token
    - POST `/api/password-reset/verify` - Verify token validity
    - POST `/api/password-reset/complete` - Complete reset with new password
  - Security features: rate limiting, IP logging, single-use tokens
  - **Enhanced Features** (`src/auth/auth.zig`):
    - PasswordResetManager: Full reset flow with audit callbacks
    - ResetRateLimiter: Per-email rate limiting with lockout
    - ResetToken: 256-bit tokens with SHA256 hashing, expiry validation
    - ResetEmailNotifier: Email notifications for reset and confirmation
    - Password validation policy (min length, uppercase, numbers, special chars)
    - Automatic token cleanup for expired/used tokens

### Quick Wins (Low Effort, High Impact) âš¡
- [x] Remove unreachable blocks - Replace with proper error types (30 min) âœ…
- [x] Add configuration validation - Check port range, paths exist (1 hour) âœ… (Already implemented in config.zig)
- [x] Fix rate limiter thread safety - Add mutex to cleanup (1 hour) âœ… (Already implemented)
- [x] Remove legacy auth function - Delete unused `verifyCredentials()` (15 min) âœ… (Removed in Phase 1)
- [x] Add health check details - Expand endpoint with dependencies (1 hour) âœ… (`src/api/health.zig:334-429` - Database, filesystem, and memory checks with response times)
- [x] Add API documentation - Document REST endpoints (2 hours) âœ… (`docs/API_REFERENCE.md` - Complete REST API reference with 15+ endpoints)
- [x] Fix MIME header validation - Add length checks (2 hours) âœ… (Implemented MAX_LINE_LENGTH validation)
- [x] Add per-username rate limiting - Extend current limiter (1 hour) âœ… (Already implemented with checkAndIncrementUser)
- [x] Add JSON structured logging - Wrap current logging (2 hours) âœ… (`src/core/logger.zig` with profile-based config, `src/core/config.zig:48,257,384-387`, `src/main.zig:55`)
- [x] Add fuzzing harnesses - For protocol parsing (2 hours) âœ… (`tests/fuzz_smtp_protocol.zig`, `tests/fuzz_mime_parser.zig`, `docs/FUZZING.md`)

## Future Ideas ðŸ’¡

- [x] Machine learning spam detection âœ… (`src/validation/ml_spam.zig`)
  - NaiveBayesClassifier with multinomial model and Laplace smoothing
  - FeatureExtractor for words, headers, URLs, HTML, statistical features
  - TrainingPipeline with online learning from user feedback
  - ModelVersionManager for versioning and rollback support
  - SpamDetector with SpamAssassin score integration
  - Stop words filtering and vocabulary management
- [x] Encrypted email storage at rest
  - [x] AES-256-GCM authenticated encryption
  - [x] Per-message unique nonces
  - [x] Key derivation from master key (HKDF)
  - [x] Password-based key derivation (Argon2id)
  - [x] Encrypted time-series storage wrapper
  - [x] Message encryption/decryption
  - [x] Serialization format with version/nonce/tag
  - [x] Key rotation support
  - [x] Secure key management
  - [x] Comprehensive test coverage
- [x] Multi-tenancy support âœ… (`src/features/multitenancy.zig`, `src/features/tenant_integration.zig`)
  - Tenant struct with settings, quotas, and policies
  - TenantManager with CRUD operations and caching
  - TenantConnection for per-connection tenant context
  - TenantResolver for domain/email tenant resolution
  - TenantRateLimiter for per-tenant rate limiting
  - TenantStorageIsolator for tenant data isolation
  - OpenAPI endpoints for tenant management
- [x] Cluster mode for high availability âœ… (`src/infrastructure/raft.zig`, `src/infrastructure/cluster.zig`)
  - Raft consensus implementation (822 lines)
  - Leader election with randomized timeouts
  - Log replication with consistency checks
  - Snapshot support for log compaction
  - Cluster membership management
- [x] Message search functionality (full-text)
  - [x] FTS5 search engine with Porter stemming
  - [x] Search CLI tool
  - [x] REST API endpoints
  - [x] Advanced filtering and sorting
  - [x] Search statistics and index rebuilding
- [x] Email archiving âœ… (`src/features/email_archiving.zig`)
  - EmailArchiver with compression and deduplication
  - RetentionPolicy with configurable expiry actions
  - LegalHold for compliance with custodians and matter IDs
  - ArchivedMessage with content hash for dedup
  - ArchiveSearchQuery with full-text and filters
  - ExportJob supporting MBOX, PST, EML, JSON formats
  - JournalService for RFC 5765 compliance
  - ArchiveCleanupService for retention enforcement
  - OpenAPI endpoints for archive management
- [x] Backup and restore utilities
  - [x] Full backup creation
  - [x] Incremental backup support
  - [x] Differential backup (framework)
  - [x] Compression support (gzip, zstd)
  - [x] Encryption support
  - [x] Checksum verification (SHA-256)
  - [x] Backup metadata tracking
  - [x] Restore with verification
  - [x] Backup listing and management
  - [x] Retention policy and pruning
  - [x] Automated backup scheduling
  - [x] Comprehensive test coverage
- [x] Migration tools from other servers âœ… (`src/tools/server_migration.zig`)
  - Postfix, Sendmail, Dovecot, Exim, Qmail, Courier, Maildir, mbox
- [x] Plugin system for extensibility âœ… (`src/core/plugin.zig`)
  - Dynamic loading, 19 hook types, PluginManager
- [x] GraphQL API - completed in v0.29.0
- [x] WebSocket real-time notifications âœ… (`src/protocol/websocket.zig`)
  - Full RFC 6455 implementation with handshake, frames, ping/pong
  - NotificationManager with broadcast and subscriptions
  - Server events for email, folder, calendar, contact, sync, quota
- [x] IMAP server integration âœ… (`src/protocol/imap.zig`)
  - RFC 3501 IMAP4rev1 with 24 commands
  - Mailbox management, flags, IDLE support
- [x] POP3 server support âœ… (`src/protocol/pop3.zig`)
  - RFC 1939 POP3 with 11 commands, SSL/TLS support
- [x] CalDAV/CardDAV support âœ… (`src/protocol/caldav.zig`)
  - RFC 4791 CalDAV and RFC 6352 CardDAV with WebDAV
- [x] ActiveSync support âœ… (`src/protocol/activesync.zig`)
  - MS-ASHTTP/MS-ASCMD with 23 commands, v2.5-v16.1
- [x] Protocol Integration âœ… (`src/protocol/integration.zig`)
  - ProtocolServer for unified SMTP/IMAP/POP3/WebSocket startup
  - ConnectionRouter for port-based protocol routing
  - ServerBuilder fluent API for configuration
  - HealthStatus aggregation across all protocols
  - ProtocolMetrics with per-protocol connection tracking
  - WebSocketFrame parser for RFC 6455 frames
  - ImapCommands and Pop3Commands parsers
- [x] Webmail client âœ… (`src/api/webmail.zig`)
  - Full responsive HTML/CSS/JS webmail interface
  - WebmailHandler with folder navigation (inbox, sent, drafts, trash, spam, archive)
  - Email composition with rich text toolbar
  - Message list with search and filtering
  - Reply/forward functionality
  - Contact panel and calendar widget
  - Theme toggle (light/dark mode)
  - Toast notifications
- [x] Mobile app for administration âœ… (`src/api/mobile_admin.zig`)
  - Progressive Web App (PWA) with manifest and service worker
  - Touch-optimized mobile-first interface
  - Pull-to-refresh, bottom navigation
  - Dashboard with server status and system metrics
  - Quick actions (flush queue, view logs, backup, test email)
  - Alerts management with acknowledgment
  - User and queue management views
  - Settings and notifications support

## Known Issues ðŸ›

### Critical
**None!** All critical issues have been resolved.
- [x] ~~TLS handshake cipher panic during STARTTLS~~ (Fixed in v0.21.0: memory alignment bug)

### High Priority
**None!** All high priority issues have been resolved.
- [x] ~~Need to verify thread safety of all shared resources~~ (Fixed in v0.21.0: comprehensive audit)
- [x] ~~Authentication accepts any credentials (development mode)~~ (Fixed: now uses database with Argon2id)
- [x] ~~Rate limiter cleanup not scheduled~~ (Fixed in v0.18.0: automatic background cleanup)

### Medium Priority
**None!** All medium priority issues have been resolved.
- [x] ~~No connection timeout enforcement yet~~ (Fixed in 0.2.0)
- [x] ~~No maximum recipients per message limit~~ (Fixed in 0.1.0)
- [x] ~~No DATA command timeout~~ (Fixed in v0.21.0: configurable DATA timeout)
- [x] ~~HTTPS webhooks not supported (HTTP only)~~ (Fixed in v0.20.0: full TLS client support)
- [x] ~~Per-user rate limiting~~ (Fixed in v0.22.0: full per-user rate limiting)
- [x] ~~Configurable cleanup interval~~ (Fixed in v0.22.0: customizable cleanup scheduling)

## Research Completed ðŸ”¬âœ…

All research topics have been thoroughly investigated and documented in **docs/RESEARCH_FINDINGS.md**:

- âœ… **Best practices for email server security** (2025 standards)
  - SPF/DKIM/DMARC mandatory implementation
  - TLS 1.2+ and MTA-STS requirements
  - Server hardening with CIS Benchmarks
  - AI-driven threat detection
  - 94% of malware delivered via email (critical statistics)

- âœ… **Modern SMTP server architectures** (microservices patterns)
  - API Gateway pattern for unified entry point
  - Database per service for independence
  - Horizontal scaling with Kubernetes HPA
  - Event-driven architecture with message buses
  - Service mesh for resilience (Istio/Linkerd)

- âœ… **Email deliverability optimization** (90%+ inbox rates)
  - Authentication protocols (SPF 70% spam reduction, DKIM 76% improvement)
  - IP warmup schedules (4-6 week gradual process)
  - Domain warmup (2-4 weeks, max 40 emails/day/mailbox)
  - List hygiene and validation strategies
  - 2025 requirements from Gmail/Yahoo/Microsoft

- âœ… **Efficient queue management strategies** (performance optimization)
  - Multi-priority queuing (5 levels from critical to deferred)
  - Exponential backoff with jitter (prevents thundering herd)
  - Batch processing (100-1000 messages per batch)
  - Connection pooling (5-50 connections, 60s idle timeout)
  - Dead Letter Queue (DLQ) for failed messages

- âœ… **Zero-downtime deployment strategies** (K8s best practices)
  - Rolling updates (default, low risk, built into K8s)
  - Blue-green deployment (instant rollback, 2x cost)
  - Canary deployment (progressive 5%â†’100%, minimal blast radius)
  - Graceful shutdown with 30s timeout
  - Database migration with expand-contract pattern

- âœ… **Email reputation management** (sender score optimization)
  - IP vs domain reputation (domain more important in 2025)
  - Reputation monitoring tools (Google Postmaster, Microsoft SNDS)
  - Blacklist management and delisting procedures
  - Feedback loop (FBL) registration and processing
  - Target <0.1% complaint rate (critical <0.3%)

**Research Document**: 50+ pages covering all topics with actionable recommendations
**Implementation Status**: Our server (v0.25.0) already implements 90%+ of best practices
**Next Steps**: See Section 7 of RESEARCH_FINDINGS.md for production deployment roadmap

---

## Project Information

**Last Updated**: 2025-12-02
**Current Version**: v0.35.0
**Zig Version**: 0.15.1
**License**: MIT

**Key Dependencies**:
- zig-tls: ~/Code/zig-tls (Pure Zig TLS 1.3 implementation)
- SQLite3: System library (user authentication database)

**Maintainers**: Add your name here when contributing

**Related Documentation**:
- README.md - Getting started guide
- TLS.md - Reverse proxy setup for production TLS
- TLS_STATUS.md - TLS implementation status
- IMPLEMENTATION_SUMMARY.md - Complete TLS technical summary
- REFACTORING.md - zig-tls library extraction details

**Priority Legend**:
- ðŸ”´ High Priority: Critical for production use
- ðŸŸ¡ Medium Priority: Important but not blocking
- ðŸŸ¢ Low Priority: Nice to have features
- ðŸ’¡ Future Ideas: Long-term vision items
- ðŸ› Known Issues: Bugs to fix
- ðŸ”¬ Research Needed: Investigation required
