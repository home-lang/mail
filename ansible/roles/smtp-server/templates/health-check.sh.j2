#!/bin/bash
# SMTP Server Health Check Script
# Generated by Ansible

HEALTH_URL="http://localhost:{{ health_port }}/health"
MAX_RETRIES=3
RETRY_DELAY=5

for i in $(seq 1 $MAX_RETRIES); do
    if curl -sf "${HEALTH_URL}" > /dev/null 2>&1; then
        exit 0
    fi

    if [ $i -lt $MAX_RETRIES ]; then
        sleep $RETRY_DELAY
    fi
done

# Health check failed after retries
echo "Health check failed after ${MAX_RETRIES} attempts" >&2
systemctl status smtp-server
exit 1
